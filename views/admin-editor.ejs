<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title><%= mag ? 'EditeazƒÉ' : 'RevistƒÉ NouƒÉ' %> ‚Äì MatchMag</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{background:#0a0a0a;font-family:'Inter',sans-serif;color:#fff}
header{background:#111;border-bottom:1px solid #1e1e1e;padding:14px 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.logo{font-family:'Bebas Neue',sans-serif;font-size:26px;color:#00e676;letter-spacing:3px}
.back{color:#888;text-decoration:none;font-size:14px}.back:hover{color:#fff}
main{max-width:900px;margin:0 auto;padding:24px 18px 120px}
h1{font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:3px;margin-bottom:18px}
.tabs{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:16px;background:#111;border:1px solid #1e1e1e;border-radius:10px;padding:8px}
.tab{padding:6px 10px;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;border:none;background:#1a1a1a;color:#555;transition:all 0.2s}
.tab.active{background:#00e676;color:#000}
.tab:hover:not(.active){background:#252525;color:#ccc}
.panel{display:none}.panel.active{display:block}
.sec{background:#111;border:1px solid #1e1e1e;border-radius:10px;padding:18px;margin-bottom:12px}
.sec-title{font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:2px;color:#00e676;margin-bottom:12px;padding-bottom:6px;border-bottom:1px solid #1e1e1e}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.row4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px}
.f{margin-bottom:10px}
label{display:block;color:#777;font-size:10px;letter-spacing:1px;text-transform:uppercase;margin-bottom:3px}
input[type=text],input[type=date],textarea,select{width:100%;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;color:#fff;padding:8px 10px;font-size:13px;font-family:inherit;outline:none;transition:border-color 0.2s;resize:vertical}
input[type=color]{width:100%;height:34px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;cursor:pointer;padding:2px 4px}
input[type=checkbox]{width:16px;height:16px;accent-color:#00e676;cursor:pointer}
input:focus,textarea:focus,select:focus{border-color:#00e676}
.cc{text-align:right;font-size:10px;color:#444;margin-top:2px}.cc.warn{color:#ff9800}
.fu{background:#1a1a1a;border:2px dashed #2a2a2a;border-radius:7px;padding:12px;text-align:center;cursor:pointer;transition:border-color 0.2s}
.fu:hover{border-color:#00e676}.fu input{display:none}
.fu-lbl{color:#444;font-size:11px;cursor:pointer}
.fn{color:#00e676;font-size:11px;margin-top:3px}
.ci{width:100%;max-height:70px;object-fit:cover;border-radius:4px;margin-bottom:5px}
.hint{background:#1a2a1a;border:1px solid #2a3a2a;border-radius:6px;padding:7px 10px;color:#4caf50;font-size:11px;margin-bottom:10px}
.color-row{display:flex;align-items:center;gap:10px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:8px 10px;margin-bottom:8px}
.color-row input[type=color]{width:40px;height:30px;flex-shrink:0}
.color-row label{margin:0;flex:1;font-size:12px;color:#ccc;text-transform:none;letter-spacing:0}
.color-row input[type=checkbox]{flex-shrink:0}

/* PER-PAGE COLOR TABLE */
.page-color-grid{display:flex;flex-direction:column;gap:6px}
.page-color-row{display:flex;align-items:center;gap:10px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:7px;padding:8px 12px}
.page-color-num{font-family:'Bebas Neue',sans-serif;font-size:18px;color:#00e676;width:28px;flex-shrink:0;text-align:center}
.page-color-name{flex:1;font-size:12px;color:#aaa}
.page-color-pair{display:flex;gap:8px;align-items:center;flex-shrink:0}
.page-color-pair label{font-size:9px;color:#555;text-transform:uppercase;letter-spacing:1px;margin:0;width:20px;text-align:center}
.page-color-pair input[type=color]{width:36px;height:28px}

/* TOC */
.toc-row{display:flex;align-items:center;gap:8px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:7px 10px;margin-bottom:4px}
.toc-pg{color:#00e676;font-family:'Bebas Neue',sans-serif;font-size:15px;width:40px;flex-shrink:0;text-align:center}
.toc-row input{flex:1;background:transparent;border:none;color:#fff;font-size:13px;outline:none;border-bottom:1px solid transparent}
.toc-row input:focus{border-bottom-color:#00e676}

/* H2H */
.h2h-row{display:flex;gap:8px;align-items:center;margin-bottom:6px}
.h2h-row input:first-child{flex:2}
.h2h-row input:last-child{width:70px;flex-shrink:0;text-align:center}
.btn-add{background:#1a2a1a;border:1px solid #2a3a2a;color:#00e676;border-radius:6px;padding:6px 12px;font-size:11px;cursor:pointer}
.btn-rem{background:#2a1a1a;border:1px solid #3a2a2a;color:#f44336;border-radius:5px;padding:4px 7px;font-size:10px;cursor:pointer}

/* FORMATION */
.form-sel{display:flex;gap:4px;margin-bottom:10px;flex-wrap:wrap}
.fb{padding:5px 9px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:4px;color:#777;font-size:11px;font-weight:700;cursor:pointer;transition:all 0.2s}
.fb.active{background:#00e676;color:#000;border-color:#00e676}
.pitch-a{border-radius:6px;padding:8px 4px;margin-bottom:8px}
.pitch-a.home-pa{background:#1a5c2e;border:2px solid #c0392b}
.pitch-a.away-pa{background:#1a5c2e;border:2px solid #27ae60}
.prow{display:flex;justify-content:space-around;margin-bottom:5px}
.pa{display:flex;flex-direction:column;align-items:center;gap:2px}
.pinputs{display:flex;gap:2px}
.ni{width:26px;background:rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.15);border-radius:3px;color:#fff;font-size:9px;padding:2px 3px;text-align:center;outline:none}
.nmi{width:58px;background:rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.15);border-radius:3px;color:#fff;font-size:8px;padding:2px 4px;text-align:center;outline:none}
.ni:focus,.nmi:focus{border-color:#00e676}

/* SHIRT PREVIEW */
.shirt-preview{display:flex;align-items:center;gap:16px;background:#1a5c2e;border-radius:8px;padding:14px;margin-bottom:12px}
.shirt-preview svg{width:50px;height:56px}
.shirt-preview-label{font-size:11px;color:#fff;opacity:0.7}

/* VOTE */
.vg{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
.vc{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:9px}
.vn{color:#444;font-size:9px;letter-spacing:1px;text-transform:uppercase;margin-bottom:3px}
.vote-status{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:8px;padding:14px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;gap:10px}
.vote-status-info{font-size:13px;color:#ccc}
.vote-status-info strong{color:#fff}
.btn-stop{background:#c0392b;color:#fff;border:none;border-radius:6px;padding:8px 16px;font-size:12px;font-weight:700;cursor:pointer}
.btn-start{background:#27ae60;color:#fff;border:none;border-radius:6px;padding:8px 16px;font-size:12px;font-weight:700;cursor:pointer}
.mvp-display{background:linear-gradient(135deg,#f39c12,#e67e22);border-radius:8px;padding:12px;text-align:center;margin-bottom:12px}
.mvp-display p{color:#fff;font-size:14px;font-weight:700}

/* LOGO */
.pos-btn{padding:5px 9px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:4px;color:#777;font-size:10px;cursor:pointer;transition:all 0.2s}
.pos-btn.active{background:#00e676;color:#000;border-color:#00e676}
.size-btn{padding:4px 9px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:4px;color:#777;font-size:11px;cursor:pointer;transition:all 0.2s}
.size-btn.active{background:#00e676;color:#000;border-color:#00e676}

/* SUBMIT */
.submit-bar{position:fixed;bottom:0;left:0;right:0;background:rgba(17,17,17,0.97);border-top:1px solid #1e1e1e;padding:10px 22px;display:flex;align-items:center;justify-content:space-between;z-index:200;backdrop-filter:blur(10px)}
.btn-c{background:#1a1a1a;color:#777;border:1px solid #2a2a2a;border-radius:6px;padding:8px 16px;font-size:12px;cursor:pointer;text-decoration:none}
.btn-s{background:#00e676;color:#000;font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:2px;border:none;border-radius:6px;padding:8px 28px;cursor:pointer}
.btn-s:hover{background:#00c853}
</style>
</head>
<body>
<header>
  <div class="logo">‚öΩ MATCHMAG</div>
  <a href="/admin" class="back">‚Üê Dashboard</a>
</header>
<main>
<h1><%= mag ? 'EDITEAZƒÇ' : 'REVISTƒÇ NOUƒÇ' %></h1>
<form method="POST" action="<%= mag ? '/admin/edit/'+mag.id : '/admin/new' %>" enctype="multipart/form-data" id="mf">

<div class="tabs">
  <button type="button" class="tab active" onclick="sp('info')">‚öôÔ∏è Info</button>
  <button type="button" class="tab" onclick="sp('colors')">üé® Culori Pagini</button>
  <button type="button" class="tab" onclick="sp('p1')">P1 CopertƒÉ</button>
  <button type="button" class="tab" onclick="sp('p2')">P2 Cuprins</button>
  <button type="button" class="tab" onclick="sp('p34')">P3-4 Avancronica</button>
  <button type="button" class="tab" onclick="sp('p56')">P5-6 JucƒÉtor</button>
  <button type="button" class="tab" onclick="sp('p7')">P7 Clasament</button>
  <button type="button" class="tab" onclick="sp('p8')">P8 Forma»õii</button>
  <button type="button" class="tab" onclick="sp('p9')">P9 Rezerve</button>
  <button type="button" class="tab" onclick="sp('p10')">P10 H2H</button>
  <button type="button" class="tab" onclick="sp('p11')">P11 Antrenori</button>
  <button type="button" class="tab" onclick="sp('p12')">P12 Palmares</button>
  <button type="button" class="tab" onclick="sp('p13')">P13 ReclamƒÉ</button>
  <button type="button" class="tab" onclick="sp('p14')">P14 Vot</button>
  <button type="button" class="tab" onclick="sp('p15')">P15 Promo</button>
  <button type="button" class="tab" onclick="sp('p16')">P16 Program</button>
</div>

<!-- INFO -->
<div class="panel active" id="panel-info">
  <div class="sec"><div class="sec-title">‚öôÔ∏è GENERAL</div>
    <div class="row2">
      <div class="f"><label>Echipa GazdƒÉ</label><input type="text" name="homeTeam" value="<%=mag?mag.homeTeam:''%>" required></div>
      <div class="f"><label>Echipa Oaspete</label><input type="text" name="awayTeam" value="<%=mag?mag.awayTeam:''%>" required></div>
    </div>
    <div class="row3">
      <div class="f"><label>Data</label><input type="date" name="matchDate" value="<%=mag?mag.matchDate:''%>"></div>
      <div class="f"><label>Stadion</label><input type="text" name="stadium" value="<%=mag?mag.stadium:''%>"></div>
      <div class="f"><label>Competi»õie</label><input type="text" name="competition" value="<%=mag?mag.competition:''%>"></div>
    </div>
  </div>
  <div class="sec"><div class="sec-title">üé® CULORI ECHIPE (folosite √Æn accent/design)</div>
    <div class="row2">
      <div>
        <div class="hint" style="margin-bottom:8px">Gazde</div>
        <div class="color-row"><input type="color" name="homeColor1" value="<%=mag?mag.homeColor1:'#e63946'%>"><label>Culoare 1 (principalƒÉ)</label></div>
        <div class="color-row"><input type="color" name="homeColor2" value="<%=mag&&mag.homeColor2?mag.homeColor2:'#ffffff'%>"><label>Culoare 2</label><input type="checkbox" name="useHomeColor2" <%=mag&&mag.homeColor2?'checked':''%>></div>
        <div class="color-row"><input type="color" name="homeColor3" value="<%=mag&&mag.homeColor3?mag.homeColor3:'#1d3557'%>"><label>Culoare 3</label><input type="checkbox" name="useHomeColor3" <%=mag&&mag.homeColor3?'checked':''%>></div>
      </div>
      <div>
        <div class="hint" style="margin-bottom:8px">Oaspete</div>
        <div class="color-row"><input type="color" name="awayColor1" value="<%=mag?mag.awayColor1:'#457b9d'%>"><label>Culoare 1 (principalƒÉ)</label></div>
        <div class="color-row"><input type="color" name="awayColor2" value="<%=mag&&mag.awayColor2?mag.awayColor2:'#ffffff'%>"><label>Culoare 2</label><input type="checkbox" name="useAwayColor2" <%=mag&&mag.awayColor2?'checked':''%>></div>
        <div class="color-row"><input type="color" name="awayColor3" value="<%=mag&&mag.awayColor3?mag.awayColor3:'#1d3557'%>"><label>Culoare 3</label><input type="checkbox" name="useAwayColor3" <%=mag&&mag.awayColor3?'checked':''%>></div>
      </div>
    </div>
  </div>
</div>

<!-- COLORS PER PAGE -->
<div class="panel" id="panel-colors">
  <div class="sec"><div class="sec-title">üé® CULORI FUNDAL + TEXT ‚Äì FIECARE PAGINƒÇ</div>
    <div class="hint">üí° SeteazƒÉ individual background-ul »ôi culoarea textului pentru fiecare paginƒÉ. Default: negru + alb.</div>
    <%
    const pageNames=['CopertƒÉ','Cuprins','Avancronica 1','Avancronica 2','JucƒÉtor ‚Äì Foto','JucƒÉtor ‚Äì Text','Clasament','Forma»õii','Rezerve','H2H','Antrenori','Palmares','ReclamƒÉ','Vot','Promo','Program'];
    const savedBg=mag&&mag.pageBg?mag.pageBg:[];
    const savedFg=mag&&mag.pageFg?mag.pageFg:[];
    %>
    <div class="page-color-grid">
      <% for(let i=1;i<=16;i++){ %>
      <div class="page-color-row">
        <div class="page-color-num"><%=i%></div>
        <div class="page-color-name"><%=pageNames[i-1]%></div>
        <div class="page-color-pair">
          <label>BG</label>
          <input type="color" name="pageBg_<%=i%>" value="<%=savedBg[i-1]||'#0d0d0d'%>">
          <label>TX</label>
          <input type="color" name="pageFg_<%=i%>" value="<%=savedFg[i-1]||'#ffffff'%>">
        </div>
      </div>
      <% } %>
    </div>
    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
      <button type="button" class="btn-add" onclick="resetAllColors('#0d0d0d','#ffffff')">üåô Toate negru+alb</button>
      <button type="button" class="btn-add" onclick="resetAllColors('#ffffff','#111111')">‚òÄÔ∏è Toate alb+negru</button>
    </div>
  </div>
</div>

<!-- P1 -->
<div class="panel" id="panel-p1">
  <div class="sec"><div class="sec-title">üìñ COPERTƒÇ</div>
    <div class="f"><label>Titlu</label><input type="text" name="coverTitle" value="<%=mag?mag.coverTitle:''%>" oninput="cc(this,40,'cc-ct')"><div class="cc" id="cc-ct">ghid: 40</div></div>
    <div class="f"><label>Fotografie (9:16)</label>
      <%if(mag&&mag.cover){%><img src="<%=mag.cover%>" class="ci"><%}%>
      <div class="fu" onclick="document.getElementById('i-cover').click()">
        <input type="file" id="i-cover" name="cover" accept="image/*" onchange="sf(this,'fn-cover')">
        <div class="fu-lbl">üì∑ √éncarcƒÉ fotografia de copertƒÉ</div>
        <div class="fn" id="fn-cover"><%=mag&&mag.cover?'‚úÖ ExistentƒÉ':''%></div>
      </div>
    </div>
  </div>
  <div class="sec"><div class="sec-title">üèüÔ∏è EMBLEMƒÇ CLUB</div>
    <div class="f">
      <%if(mag&&mag.clubLogo){%><img src="<%=mag.clubLogo%>" style="width:70px;height:70px;object-fit:contain;border-radius:8px;border:1px solid #2a2a2a;background:#1a1a1a;display:block;margin-bottom:8px"><%}%>
      <div class="fu" onclick="document.getElementById('i-clogo').click()">
        <input type="file" id="i-clogo" name="clubLogo" accept="image/*" onchange="sf(this,'fn-clogo')">
        <div class="fu-lbl">üì∑ PNG cu fundal transparent recomandat</div>
        <div class="fn" id="fn-clogo"><%=mag&&mag.clubLogo?'‚úÖ ExistentƒÉ':''%></div>
      </div>
    </div>
    <div class="f"><label>Pozi»õie pe copertƒÉ</label>
      <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:4px">
        <%[['top-left','‚Üñ Sus St.'],['top-center','‚Üë Sus C.'],['top-right','‚Üó Sus Dr.']].forEach(function(p){%>
        <button type="button" class="pos-btn <%=(mag&&mag.logoPosition===p[0])||(!mag&&p[0]==='top-left')?'active':''%>" onclick="selPos('<%=p[0]%>')"><%=p[1]%></button>
        <%})%>
      </div>
      <input type="hidden" name="logoPosition" id="logoPosVal" value="<%=mag?mag.logoPosition||'top-left':'top-left'%>">
    </div>
    <div class="f"><label>Dimensiune pe copertƒÉ</label>
      <div style="display:flex;gap:6px;margin-top:4px">
        <%[['small','MicƒÉ'],['medium','Medie'],['large','Mare']].forEach(function(s){%>
        <button type="button" class="size-btn <%=(mag&&mag.logoSize===s[0])||(!mag&&s[0]==='medium')?'active':''%>" onclick="selSize('<%=s[0]%>')"><%=s[1]%></button>
        <%})%>
      </div>
      <input type="hidden" name="logoSize" id="logoSizeVal" value="<%=mag?mag.logoSize||'medium':'medium'%>">
    </div>
  </div>
</div>

<!-- P2 TOC -->
<div class="panel" id="panel-p2">
  <div class="sec"><div class="sec-title">üìã CUPRINS</div>
    <%const tocDefs=[{pg:'2',lbl:'Cuprins'},{pg:'3-4',lbl:'Avancronica'},{pg:'5-6',lbl:'JucƒÉtor Cheie'},{pg:'7',lbl:'Clasament'},{pg:'8',lbl:'Forma»õii de Start'},{pg:'9',lbl:'Rezerve'},{pg:'10',lbl:'Head to Head'},{pg:'11',lbl:'Ce spun antrenorii'},{pg:'12',lbl:'Palmares'},{pg:'13',lbl:'ReclamƒÉ'},{pg:'14',lbl:'JucƒÉtorul Meciului'},{pg:'15',lbl:'Promo'},{pg:'16',lbl:'Program'}];%>
    <%const savedToc=mag&&mag.tocItems?mag.tocItems:[];%>
    <%tocDefs.forEach(function(def,i){%>
    <div class="toc-row">
      <div class="toc-pg"><%=def.pg%></div>
      <input type="text" name="tocItem" value="<%=savedToc[i]||def.lbl%>">
    </div>
    <%})%>
  </div>
</div>

<!-- P3-4 -->
<div class="panel" id="panel-p34">
  <div class="sec"><div class="sec-title">üìù AVANCRONICA</div>
    <div class="f"><label>Titlu</label><input type="text" name="avancronicaTitle" value="<%=mag?mag.avancronicaTitle:'Avancronica'%>"></div>
    <div class="f"><label>Pagina 3</label><textarea name="avancronicaP1" rows="8" oninput="cc(this,600,'cc-ap1')"><%=mag?mag.avancronicaP1:''%></textarea><div class="cc" id="cc-ap1">ghid: 600</div></div>
    <div class="f"><label>Pagina 4</label><textarea name="avancronicaP2" rows="8" oninput="cc(this,600,'cc-ap2')"><%=mag?mag.avancronicaP2:''%></textarea><div class="cc" id="cc-ap2">ghid: 600</div></div>
  </div>
</div>

<!-- P5-6 -->
<div class="panel" id="panel-p56">
  <div class="sec"><div class="sec-title">‚≠ê JUCƒÇTOR CHEIE</div>
    <div class="f"><label>Fotografie</label>
      <%if(mag&&mag.playerPhoto){%><img src="<%=mag.playerPhoto%>" class="ci"><%}%>
      <div class="fu" onclick="document.getElementById('i-pl').click()">
        <input type="file" id="i-pl" name="playerPhoto" accept="image/*" onchange="sf(this,'fn-pl')">
        <div class="fu-lbl">üì∑ Portret jucƒÉtor</div>
        <div class="fn" id="fn-pl"><%=mag&&mag.playerPhoto?'‚úÖ ExistentƒÉ':''%></div>
      </div>
    </div>
    <div class="row2">
      <div class="f"><label>Nume</label><input type="text" name="playerTitle" value="<%=mag?mag.playerTitle:''%>" oninput="cc(this,30,'cc-pn')"><div class="cc" id="cc-pn">ghid: 30</div></div>
      <div class="f"><label>Subtitlu</label><input type="text" name="playerSubtitle" value="<%=mag?mag.playerSubtitle:''%>" oninput="cc(this,60,'cc-ps')"><div class="cc" id="cc-ps">ghid: 60</div></div>
    </div>
    <div class="f"><label>Text</label><textarea name="playerText" rows="8" oninput="cc(this,600,'cc-ptx')"><%=mag?mag.playerText:''%></textarea><div class="cc" id="cc-ptx">ghid: 600</div></div>
  </div>
</div>

<!-- P7 -->
<div class="panel" id="panel-p7">
  <div class="sec"><div class="sec-title">üèÜ CLASAMENT</div>
    <div class="f"><label>Titlu</label><input type="text" name="standingsTitle" value="<%=mag?mag.standingsTitle:'Clasament'%>"></div>
    <div class="hint">üí° Recomandat: <strong>SofaScore embed</strong> ‚Äì mai curat pe mobil. Sau Flashscore.</div>
    <div class="f"><label>Cod Embed</label><textarea name="standingsEmbed" rows="4"><%=mag?mag.standingsEmbed:''%></textarea></div>
  </div>
</div>

<!-- P8 FORMATIONS -->
<div class="panel" id="panel-p8">
  <div class="sec"><div class="sec-title">‚öΩ TITLU + TRICOURI</div>
    <div class="f"><label>Text titlu sus (ex: "Forma»õii probabile" sau "UPDATE: Forma»õii de start")</label>
      <input type="text" name="formationTitle" value="<%=mag?mag.formationTitle||'Forma»õii probabile':'Forma»õii probabile'%>">
    </div>
    <div class="row2">
      <div>
        <div class="hint">Tricou GAZDE</div>
        <div id="shirtPreviewHome" style="background:#2e8b45;border-radius:8px;padding:12px;display:flex;align-items:center;gap:14px;margin-bottom:10px">
          <svg id="svgHome" viewBox="0 0 50 55" width="50" height="56">
            <path id="shHome" d="M5,14 L0,28 L13,30 L13,54 L37,54 L37,30 L50,28 L45,14 L36,10 C34,16 16,16 14,10 Z" fill="#e63946" stroke="rgba(0,0,0,0.2)" stroke-width="1.2"/>
            <path id="clHome" d="M14,10 C16,16 34,16 36,10 L38,6 C34,2 30,0 25,0 C20,0 16,2 12,6 Z" fill="#1d3557" stroke="rgba(0,0,0,0.2)" stroke-width="1.2"/>
            <text x="25" y="36" text-anchor="middle" font-size="11" font-weight="900" id="numHome" fill="#ffffff">7</text>
          </svg>
          <div class="row4" style="flex:1">
            <div class="f"><label>Tricou</label><input type="color" name="homeShirtColor" value="<%=mag?mag.homeShirtColor||'#e63946':'#e63946'%>" oninput="updateShirt('home','sh',this.value)"></div>
            <div class="f"><label>Guler</label><input type="color" name="homeCollarColor" value="<%=mag?mag.homeCollarColor||'#1d3557':'#1d3557'%>" oninput="updateShirt('home','cl',this.value)"></div>
            <div class="f"><label>NumƒÉr</label><input type="color" name="homeNumColor" value="<%=mag?mag.homeNumColor||'#ffffff':'#ffffff'%>" oninput="updateShirt('home','num',this.value)"></div>
            <div class="f"><label>Nume</label><input type="color" name="homeNameColor" value="<%=mag?mag.homeNameColor||'#ffffff':'#ffffff'%>"></div>
          </div>
        </div>
        <div class="f"><label>Forma»õie Gazde</label>
          <div class="form-sel" id="homeFrmSel">
            <%['4-3-3','4-4-2','4-2-3-1','3-4-3','4-1-4-1','5-4-1','5-3-2'].forEach(f=>{%>
              <button type="button" class="fb <%-((mag&&mag.homeFormation===f)||(!mag&&f==='4-3-3'))?'active':''%>" onclick="selForm('home','<%=f%>')"><%=f%></button>
            <%})%>
          </div>
          <input type="hidden" name="homeFormation" id="homeFormVal" value="<%=mag?mag.homeFormation:'4-3-3'%>">
        </div>
        <div class="f"><label>Titlu echipƒÉ gazde</label><input type="text" name="homeFormationTitle" value="<%=mag?mag.homeFormationTitle:''%>"></div>
        <div class="f"><label>Antrenor gazde (pe teren)</label><input type="text" name="homeCoachFormation" value="<%=mag?mag.homeCoachFormation:''%>" placeholder="ex: Mihai Teja">
        </div>
        <div class="f"><label>Logo</label>
          <%if(mag&&mag.homeLogoPhoto){%><img src="<%=mag.homeLogoPhoto%>" class="ci" style="max-height:44px;object-fit:contain"><%}%>
          <div class="fu" onclick="document.getElementById('i-hl').click()" style="padding:8px">
            <input type="file" id="i-hl" name="homeLogoPhoto" accept="image/*" onchange="sf(this,'fn-hl')">
            <div class="fu-lbl" style="font-size:10px">üì∑ Logo</div>
            <div class="fn" id="fn-hl"><%=mag&&mag.homeLogoPhoto?'‚úÖ':''%></div>
          </div>
        </div>
      </div>
      <div>
        <div class="hint">Tricou OASPETE</div>
        <div id="shirtPreviewAway" style="background:#2e8b45;border-radius:8px;padding:12px;display:flex;align-items:center;gap:14px;margin-bottom:10px">
          <svg id="svgAway" viewBox="0 0 50 55" width="50" height="56">
            <path id="shAway" d="M5,14 L0,28 L13,30 L13,54 L37,54 L37,30 L50,28 L45,14 L36,10 C34,16 16,16 14,10 Z" fill="#457b9d" stroke="rgba(0,0,0,0.2)" stroke-width="1.2"/>
            <path id="clAway" d="M14,10 C16,16 34,16 36,10 L38,6 C34,2 30,0 25,0 C20,0 16,2 12,6 Z" fill="#ffffff" stroke="rgba(0,0,0,0.2)" stroke-width="1.2"/>
            <text x="25" y="36" text-anchor="middle" font-size="11" font-weight="900" id="numAway" fill="#ffffff">9</text>
          </svg>
          <div class="row4" style="flex:1">
            <div class="f"><label>Tricou</label><input type="color" name="awayShirtColor" value="<%=mag?mag.awayShirtColor||'#457b9d':'#457b9d'%>" oninput="updateShirt('away','sh',this.value)"></div>
            <div class="f"><label>Guler</label><input type="color" name="awayCollarColor" value="<%=mag?mag.awayCollarColor||'#ffffff':'#ffffff'%>" oninput="updateShirt('away','cl',this.value)"></div>
            <div class="f"><label>NumƒÉr</label><input type="color" name="awayNumColor" value="<%=mag?mag.awayNumColor||'#ffffff':'#ffffff'%>" oninput="updateShirt('away','num',this.value)"></div>
            <div class="f"><label>Nume</label><input type="color" name="awayNameColor" value="<%=mag?mag.awayNameColor||'#ffffff':'#ffffff'%>"></div>
          </div>
        </div>
        <div class="f"><label>Forma»õie Oaspete</label>
          <div class="form-sel" id="awayFrmSel">
            <%['4-3-3','4-4-2','4-2-3-1','3-4-3','4-1-4-1','5-4-1','5-3-2'].forEach(f=>{%>
              <button type="button" class="fb <%-((mag&&mag.awayFormation===f)||(!mag&&f==='4-3-3'))?'active':''%>" onclick="selForm('away','<%=f%>')"><%=f%></button>
            <%})%>
          </div>
          <input type="hidden" name="awayFormation" id="awayFormVal" value="<%=mag?mag.awayFormation:'4-3-3'%>">
        </div>
        <div class="f"><label>Titlu echipƒÉ oaspete</label><input type="text" name="awayFormationTitle" value="<%=mag?mag.awayFormationTitle:''%>"></div>
        <div class="f"><label>Antrenor oaspete (pe teren)</label><input type="text" name="awayCoachFormation" value="<%=mag?mag.awayCoachFormation:''%>" placeholder="ex: Dorinel Munteanu"></div>
        <div class="f"><label>Logo</label>
          <%if(mag&&mag.awayLogoPhoto){%><img src="<%=mag.awayLogoPhoto%>" class="ci" style="max-height:44px;object-fit:contain"><%}%>
          <div class="fu" onclick="document.getElementById('i-al').click()" style="padding:8px">
            <input type="file" id="i-al" name="awayLogoPhoto" accept="image/*" onchange="sf(this,'fn-al')">
            <div class="fu-lbl" style="font-size:10px">üì∑ Logo</div>
            <div class="fn" id="fn-al"><%=mag&&mag.awayLogoPhoto?'‚úÖ':''%></div>
          </div>
        </div>
      </div>
    </div>
    <div class="hint">üí° JucƒÉtori: apasƒÉ tab P8 JucƒÉtori de mai jos</div>
  </div>
  <div class="sec"><div class="sec-title">‚öΩ JUCƒÇTORI</div>
    <div class="row2">
      <div>
        <div style="color:#c0392b;font-size:11px;font-weight:700;margin-bottom:8px">GAZDE</div>
        <div id="homePitch"></div>
      </div>
      <div>
        <div style="color:#27ae60;font-size:11px;font-weight:700;margin-bottom:8px">OASPETE</div>
        <div id="awayPitch"></div>
      </div>
    </div>
  </div>
</div>

<!-- P9 -->
<div class="panel" id="panel-p9">
  <div class="sec"><div class="sec-title">üìã REZERVE</div>
    <div class="row2">
      <div class="f"><label>Rezerve Gazde</label><textarea name="homeReserves" rows="10" placeholder="12. Nume&#10;13. Nume..."><%=mag?mag.homeReserves:''%></textarea></div>
      <div class="f"><label>Rezerve Oaspete</label><textarea name="awayReserves" rows="10" placeholder="12. Nume&#10;13. Nume..."><%=mag?mag.awayReserves:''%></textarea></div>
    </div>
  </div>
</div>

<!-- P10 H2H -->
<div class="panel" id="panel-p10">
  <div class="sec"><div class="sec-title">üìä HEAD TO HEAD</div>
    <div class="f"><label>Titlu</label><input type="text" name="h2hTitle" value="<%=mag?mag.h2hTitle:'√ént√¢lniri directe'%>"></div>
    <div id="h2hRows">
      <%const h2hL=mag&&mag.h2hLabels?mag.h2hLabels:['Victorii gazde','Egal','Victorii oaspete'];%>
      <%const h2hV=mag&&mag.h2hValues?mag.h2hValues:['0','0','0'];%>
      <%h2hL.forEach(function(lbl,i){%>
      <div class="h2h-row" id="h2hr-<%=i%>">
        <input type="text" name="h2hLabel" value="<%=lbl%>" placeholder="Label">
        <input type="text" name="h2hValue" value="<%=h2hV[i]||''%>" placeholder="0">
        <button type="button" class="btn-rem" onclick="remH2H(<%=i%>)">‚úï</button>
      </div>
      <%})%>
    </div>
    <button type="button" class="btn-add" onclick="addH2H()" style="margin-top:8px">+ AdaugƒÉ r√¢nd</button>
    <div class="f" style="margin-top:12px"><label>Embed YouTube</label><textarea name="h2hYoutubeEmbed" rows="3"><%=mag?mag.h2hYoutubeEmbed:''%></textarea></div>
  </div>
</div>

<!-- P11 -->
<div class="panel" id="panel-p11">
  <div class="sec"><div class="sec-title">üí¨ CE SPUN ANTRENORII</div>
    <div class="f"><label>Titlu</label><input type="text" name="coachesTitle" value="<%=mag?mag.coachesTitle:'Ce spun antrenorii'%>"></div>
    <div class="row2">
      <div class="f">
        <label style="color:#c0392b">‚ñ∂ GAZDE</label>
        <%if(mag&&mag.homeCoachPhoto){%><img src="<%=mag.homeCoachPhoto%>" class="ci" style="max-height:70px;object-fit:cover;border:2px solid #c0392b;border-radius:6px"><%}%>
        <div class="fu" onclick="document.getElementById('i-hc').click()" style="padding:9px">
          <input type="file" id="i-hc" name="homeCoachPhoto" accept="image/*" onchange="sf(this,'fn-hc')">
          <div class="fu-lbl" style="font-size:10px">üì∑ PozƒÉ antrenor</div>
          <div class="fn" id="fn-hc"><%=mag&&mag.homeCoachPhoto?'‚úÖ':''%></div>
        </div>
        <div class="f" style="margin-top:8px"><label>Nume</label><input type="text" name="homeCoachName" value="<%=mag?mag.homeCoachName:''%>"></div>
        <div class="f"><label>Declara»õie</label><textarea name="homeCoachText" rows="5" oninput="cc(this,300,'cc-hct')"><%=mag?mag.homeCoachText:''%></textarea><div class="cc" id="cc-hct">ghid: 300</div></div>
      </div>
      <div class="f">
        <label style="color:#27ae60">‚ñ∂ OASPETE</label>
        <%if(mag&&mag.awayCoachPhoto){%><img src="<%=mag.awayCoachPhoto%>" class="ci" style="max-height:70px;object-fit:cover;border:2px solid #27ae60;border-radius:6px"><%}%>
        <div class="fu" onclick="document.getElementById('i-ac').click()" style="padding:9px">
          <input type="file" id="i-ac" name="awayCoachPhoto" accept="image/*" onchange="sf(this,'fn-ac')">
          <div class="fu-lbl" style="font-size:10px">üì∑ PozƒÉ antrenor</div>
          <div class="fn" id="fn-ac"><%=mag&&mag.awayCoachPhoto?'‚úÖ':''%></div>
        </div>
        <div class="f" style="margin-top:8px"><label>Nume</label><input type="text" name="awayCoachName" value="<%=mag?mag.awayCoachName:''%>"></div>
        <div class="f"><label>Declara»õie</label><textarea name="awayCoachText" rows="5" oninput="cc(this,300,'cc-act')"><%=mag?mag.awayCoachText:''%></textarea><div class="cc" id="cc-act">ghid: 300</div></div>
      </div>
    </div>
  </div>
</div>

<!-- P12 -->
<div class="panel" id="panel-p12">
  <div class="sec"><div class="sec-title">üèÖ PALMARES</div>
    <div class="f"><label>Titlu</label><input type="text" name="palmaresTitle" value="<%=mag?mag.palmaresTitle:'Palmares'%>"></div>
    <div class="f"><label>Fotografie portret</label>
      <%if(mag&&mag.palmaresPhoto){%><img src="<%=mag.palmaresPhoto%>" class="ci"><%}%>
      <div class="fu" onclick="document.getElementById('i-palm').click()">
        <input type="file" id="i-palm" name="palmaresPhoto" accept="image/*" onchange="sf(this,'fn-palm')">
        <div class="fu-lbl">üì∑ Portret (jucƒÉtor cu trofeu)</div>
        <div class="fn" id="fn-palm"><%=mag&&mag.palmaresPhoto?'‚úÖ ExistentƒÉ':''%></div>
      </div>
    </div>
    <div class="f"><label>Text</label><textarea name="palmaresText" rows="8" oninput="cc(this,800,'cc-palm')"><%=mag?mag.palmaresText:''%></textarea><div class="cc" id="cc-palm">ghid: 800</div></div>
  </div>
</div>

<!-- P13 -->
<div class="panel" id="panel-p13">
  <div class="sec"><div class="sec-title">üì¢ RECLAMƒÇ</div>
    <div class="f"><label>Titlu (op»õional)</label><input type="text" name="adTitle" value="<%=mag?mag.adTitle:''%>"></div>
    <div class="f"><label>Cod Embed</label><textarea name="adEmbed" rows="5"><%=mag?mag.adEmbed:''%></textarea></div>
  </div>
</div>

<!-- P14 VOTE -->
<div class="panel" id="panel-p14">
  <%if(mag){%>
  <div class="sec"><div class="sec-title">üéõÔ∏è CONTROL VOT LIVE</div>
    <%if(mag.voteStopped){%>
    <div class="mvp-display"><p>üèÜ Votul s-a √Æncheiat ¬∑ MVP: <strong><%=mag.mvp||'‚Äì'%></strong></p></div>
    <div class="vote-status">
      <div class="vote-status-info">Votul este <strong>OPRIT</strong></div>
      <button type="button" class="btn-start" onclick="startVote()">‚ñ∂ Redeschide vot</button>
    </div>
    <%}else{%>
    <div class="vote-status">
      <div class="vote-status-info">Votul este <strong>ACTIV</strong></div>
      <button type="button" class="btn-stop" onclick="stopVote()">‚èπ STOP VOT + MVP</button>
    </div>
    <%}%>
  </div>
  <%}%>
  <div class="sec"><div class="sec-title">üó≥Ô∏è CANDIDA»öI</div>
    <div class="vg">
      <div class="vc"><div class="vn">Candidat 1</div><input type="text" name="voteCandidate0" value="<%=mag?mag.voteCandidate0:''%>" placeholder="Nume jucƒÉtor"></div>
      <div class="vc"><div class="vn">Candidat 2</div><input type="text" name="voteCandidate1" value="<%=mag?mag.voteCandidate1:''%>" placeholder="Nume jucƒÉtor"></div>
      <div class="vc"><div class="vn">Candidat 3</div><input type="text" name="voteCandidate2" value="<%=mag?mag.voteCandidate2:''%>" placeholder="Nume jucƒÉtor"></div>
    </div>
  </div>
</div>

<!-- P15 -->
<div class="panel" id="panel-p15">
  <div class="sec"><div class="sec-title">üì£ BANNER PROMO</div>
    <div class="f"><label>Cod Embed Banner</label><textarea name="promoEmbed" rows="5"><%=mag?mag.promoEmbed:''%></textarea></div>
  </div>
</div>

<!-- P16 -->
<div class="panel" id="panel-p16">
  <div class="sec"><div class="sec-title">üèüÔ∏è PROGRAM</div>
    <div class="f"><label>Fotografie landscape</label>
      <%if(mag&&mag.stadiumPhoto){%><img src="<%=mag.stadiumPhoto%>" class="ci"><%}%>
      <div class="fu" onclick="document.getElementById('i-stad').click()">
        <input type="file" id="i-stad" name="stadiumPhoto" accept="image/*" onchange="sf(this,'fn-stad')">
        <div class="fu-lbl">üì∑ Fotografie stadion / program</div>
        <div class="fn" id="fn-stad"><%=mag&&mag.stadiumPhoto?'‚úÖ ExistentƒÉ':''%></div>
      </div>
    </div>
    <div class="f"><label>Titlu</label><input type="text" name="programTitle" value="<%=mag?mag.programTitle:'Programul echipei noastre'%>"></div>
    <div class="f"><label>Text</label><textarea name="programText" rows="6" oninput="cc(this,400,'cc-prog')"><%=mag?mag.programText:''%></textarea><div class="cc" id="cc-prog">ghid: 400</div></div>
  </div>
</div>

<div id="hiddenPlayers"></div>

<div class="submit-bar">
  <span style="color:#444;font-size:11px">16 pagini ¬∑ culori per paginƒÉ ¬∑ teren unificat</span>
  <div style="display:flex;gap:8px">
    <a href="/admin" class="btn-c">AnuleazƒÉ</a>
    <button type="submit" class="btn-s">üíæ SALVEAZƒÇ</button>
  </div>
</div>
</form>
</main>

<script>
const MAG_ID='<%=mag?mag.id:null%>';
const FORMATIONS={'4-3-3':[[1],[4,3,2,5],[8,6,10],[9,7,11]],'4-4-2':[[1],[2,3,4,5],[6,7,8,9],[10,11]],'4-2-3-1':[[1],[2,3,4,5],[6,8],[7,10,11],[9]],'3-4-3':[[1],[2,5,3],[4,6,8,7],[9,10,11]],'4-1-4-1':[[1],[2,3,4,5],[6],[7,8,9,10],[11]],'5-4-1':[[1],[2,3,5,4,6],[7,8,9,10],[11]],'5-3-2':[[1],[2,3,5,4,6],[7,8,9],[10,11]]};
const eHN=<%- JSON.stringify(mag&&mag.homePlayerNumbers?mag.homePlayerNumbers:Array(11).fill('')) %>;
const eHNm=<%- JSON.stringify(mag&&mag.homePlayerNames?mag.homePlayerNames:Array(11).fill('')) %>;
const eAN=<%- JSON.stringify(mag&&mag.awayPlayerNumbers?mag.awayPlayerNumbers:Array(11).fill('')) %>;
const eANm=<%- JSON.stringify(mag&&mag.awayPlayerNames?mag.awayPlayerNames:Array(11).fill('')) %>;
let hD={nums:[...eHN],names:[...eHNm]};
let aD={nums:[...eAN],names:[...eANm]};

function sp(id){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('panel-'+id).classList.add('active');
  event.target.classList.add('active');
  if(id==='p8'){renderPitch('home');renderPitch('away');}
}
function selForm(team,f){
  document.getElementById(team+'FormVal').value=f;
  document.querySelectorAll('#'+team+'FrmSel .fb').forEach(b=>b.classList.toggle('active',b.textContent===f));
  renderPitch(team);
}
function renderPitch(team){
  const f=document.getElementById(team+'FormVal').value;
  const rows=FORMATIONS[f]||FORMATIONS['4-3-3'];
  const d=team==='home'?hD:aD;
  const col=team==='home'?'#c0392b':'#27ae60';
  const rev=[...rows]; // same order as magazine: GK first = top
  let idx=0,html=`<div class="pitch-a ${team==='home'?'home-pa':'away-pa'}">`;
  rev.forEach(row=>{
    html+=`<div class="prow">`;
    row.forEach(()=>{
      const n=d.nums[idx]||'';const nm=d.names[idx]||'';const i=idx;
      html+=`<div class="pa"><div class="pinputs"><input class="ni" type="text" placeholder="#" value="${n.replace(/"/g,'&quot;')}" maxlength="2" oninput="upd('${team}',${i},'n',this.value)"><input class="nmi" type="text" placeholder="Nume" value="${nm.replace(/"/g,'&quot;')}" oninput="upd('${team}',${i},'nm',this.value)"></div></div>`;
      idx++;
    });
    html+=`</div>`;
  });
  html+=`</div>`;
  document.getElementById(team+'Pitch').innerHTML=html;
  syncH();
}
function upd(team,idx,field,val){const d=team==='home'?hD:aD;if(field==='n')d.nums[idx]=val;else d.names[idx]=val;syncH();}
function syncH(){
  let h='';
  for(let i=0;i<11;i++){
    h+=`<input type="hidden" name="homeNumber_${i}" value="${(hD.nums[i]||'').replace(/"/g,'&quot;')}">`;
    h+=`<input type="hidden" name="homeName_${i}" value="${(hD.names[i]||'').replace(/"/g,'&quot;')}">`;
    h+=`<input type="hidden" name="awayNumber_${i}" value="${(aD.nums[i]||'').replace(/"/g,'&quot;')}">`;
    h+=`<input type="hidden" name="awayName_${i}" value="${(aD.names[i]||'').replace(/"/g,'&quot;')}">`;
  }
  document.getElementById('hiddenPlayers').innerHTML=h;
}

// Shirt live preview in admin
function updateShirt(team, part, val){
  const el=document.getElementById((part==='sh'?'sh':(part==='cl'?'cl':'num'))+team.charAt(0).toUpperCase()+team.slice(1));
  if(!el)return;
  if(part==='num')el.setAttribute('fill',val);
  else el.setAttribute('fill',val);
}

let h2hCount=document.querySelectorAll('.h2h-row').length;
function addH2H(){
  const c=document.getElementById('h2hRows');
  const d=document.createElement('div');d.className='h2h-row';d.id='h2hr-'+h2hCount;
  d.innerHTML=`<input type="text" name="h2hLabel" placeholder="Label"><input type="text" name="h2hValue" placeholder="0"><button type="button" class="btn-rem" onclick="remH2H(${h2hCount})">‚úï</button>`;
  c.appendChild(d);h2hCount++;
}
function remH2H(i){const el=document.getElementById('h2hr-'+i);if(el&&document.querySelectorAll('.h2h-row').length>1)el.remove();}
function sf(input,nameId){if(input.files&&input.files[0])document.getElementById(nameId).textContent='‚úÖ '+input.files[0].name;}
function cc(el,guide,id){
  const len=el.value.length,el2=document.getElementById(id);
  if(!el2)return;
  el2.textContent=`${len} (ghid: ${guide})`;
  el2.className='cc'+(len>guide*1.5?' warn':'');
}
function selPos(p){
  document.getElementById('logoPosVal').value=p;
  document.querySelectorAll('.pos-btn').forEach(b=>b.classList.toggle('active',b.getAttribute('onclick').includes("'"+p+"'")));
}
function selSize(s){
  document.getElementById('logoSizeVal').value=s;
  document.querySelectorAll('.size-btn').forEach(b=>b.classList.toggle('active',b.getAttribute('onclick').includes("'"+s+"'")));
}
function resetAllColors(bg, fg){
  for(let i=1;i<=16;i++){
    const bgEl=document.querySelector(`input[name="pageBg_${i}"]`);
    const fgEl=document.querySelector(`input[name="pageFg_${i}"]`);
    if(bgEl)bgEl.value=bg;
    if(fgEl)fgEl.value=fg;
  }
}
function stopVote(){
  if(!MAG_ID||!confirm('Opre»ôti votul? MVP va fi afi»ôat automat cititorilor.'))return;
  fetch(`/admin/stop-vote/${MAG_ID}`,{method:'POST'}).then(r=>r.json()).then(d=>{if(d.success)location.reload();});
}
function startVote(){
  if(!MAG_ID)return;
  fetch(`/admin/start-vote/${MAG_ID}`,{method:'POST'}).then(r=>r.json()).then(d=>{if(d.success)location.reload();});
}
syncH();
</script>
</body>
</html>
