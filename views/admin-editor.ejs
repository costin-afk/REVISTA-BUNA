<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title><%= mag ? 'EditeazÄƒ' : 'RevistÄƒ NouÄƒ' %> â€“ MatchMag</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{background:#0a0a0a;font-family:'Inter',sans-serif;color:#fff}
header{background:#111;border-bottom:1px solid #1e1e1e;padding:14px 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.logo{font-family:'Bebas Neue',sans-serif;font-size:26px;color:#00e676;letter-spacing:3px}
.back{color:#888;text-decoration:none;font-size:14px}.back:hover{color:#fff}
main{max-width:900px;margin:0 auto;padding:24px 18px 120px}
h1{font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:3px;margin-bottom:18px}
.tabs{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:16px;background:#111;border:1px solid #1e1e1e;border-radius:10px;padding:8px}
.tab{padding:6px 10px;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;border:none;background:#1a1a1a;color:#555;transition:all 0.2s}
.tab.active{background:#00e676;color:#000}
.tab:hover:not(.active){background:#252525;color:#ccc}
.panel{display:none}.panel.active{display:block}
.sec{background:#111;border:1px solid #1e1e1e;border-radius:10px;padding:18px;margin-bottom:12px}
.sec-title{font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:2px;color:#00e676;margin-bottom:12px;padding-bottom:6px;border-bottom:1px solid #1e1e1e}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.f{margin-bottom:10px}
label{display:block;color:#777;font-size:10px;letter-spacing:1px;text-transform:uppercase;margin-bottom:3px}
input[type=text],input[type=date],textarea,select{width:100%;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;color:#fff;padding:8px 10px;font-size:13px;font-family:inherit;outline:none;transition:border-color 0.2s;resize:vertical}
input[type=color]{width:100%;height:34px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;cursor:pointer;padding:2px 4px}
input[type=checkbox]{width:16px;height:16px;accent-color:#00e676;cursor:pointer}
input:focus,textarea:focus,select:focus{border-color:#00e676}
.cc{text-align:right;font-size:10px;color:#444;margin-top:2px}
.cc.warn{color:#ff9800}
.fu{background:#1a1a1a;border:2px dashed #2a2a2a;border-radius:7px;padding:12px;text-align:center;cursor:pointer;transition:border-color 0.2s}
.fu:hover{border-color:#00e676}.fu input{display:none}
.fu-lbl{color:#444;font-size:11px;cursor:pointer}
.fn{color:#00e676;font-size:11px;margin-top:3px}
.ci{width:100%;max-height:70px;object-fit:cover;border-radius:4px;margin-bottom:5px}
.hint{background:#1a2a1a;border:1px solid #2a3a2a;border-radius:6px;padding:7px 10px;color:#4caf50;font-size:11px;margin-bottom:10px}
.color-row{display:flex;align-items:center;gap:10px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:8px 10px;margin-bottom:8px}
.color-row input[type=color]{width:40px;height:30px;flex-shrink:0}
.color-row label{margin:0;flex:1;font-size:12px;color:#ccc;text-transform:none;letter-spacing:0}
.color-row input[type=checkbox]{flex-shrink:0}
/* TOC */
.toc-row{display:flex;align-items:center;gap:8px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:7px 10px;margin-bottom:4px}
.toc-pg{color:#00e676;font-family:'Bebas Neue',sans-serif;font-size:15px;width:40px;flex-shrink:0;text-align:center}
.toc-row input{flex:1;background:transparent;border:none;color:#fff;font-size:13px;outline:none;border-bottom:1px solid transparent}
.toc-row input:focus{border-bottom-color:#00e676}
/* H2H */
.h2h-row{display:flex;gap:8px;align-items:center;margin-bottom:6px}
.h2h-row input:first-child{flex:2}
.h2h-row input:last-child{width:70px;flex-shrink:0;text-align:center}
.btn-add{background:#1a2a1a;border:1px solid #2a3a2a;color:#00e676;border-radius:6px;padding:6px 12px;font-size:11px;cursor:pointer}
.btn-rem{background:#2a1a1a;border:1px solid #3a2a2a;color:#f44336;border-radius:5px;padding:4px 7px;font-size:10px;cursor:pointer}
/* FORMATION */
.form-sel{display:flex;gap:4px;margin-bottom:10px;flex-wrap:wrap}
.fb{padding:5px 9px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:4px;color:#777;font-size:11px;font-weight:700;cursor:pointer;transition:all 0.2s}
.fb.active{background:#00e676;color:#000;border-color:#00e676}
.pitch-a{border-radius:6px;padding:8px 4px;margin-bottom:8px}
.pitch-a.home-pa{background:#1a5c2e;border:2px solid #c0392b}
.pitch-a.away-pa{background:#1a5c2e;border:2px solid #27ae60}
.prow{display:flex;justify-content:space-around;margin-bottom:5px}
.pa{display:flex;flex-direction:column;align-items:center;gap:2px}
.pinputs{display:flex;gap:2px}
.ni{width:26px;background:rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.15);border-radius:3px;color:#fff;font-size:9px;padding:2px 3px;text-align:center;outline:none}
.nmi{width:58px;background:rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.15);border-radius:3px;color:#fff;font-size:8px;padding:2px 4px;text-align:center;outline:none}
.ni:focus,.nmi:focus{border-color:#00e676}
/* VOTE STOP */
.vote-status{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:8px;padding:14px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;gap:10px}
.vote-status-info{font-size:13px;color:#ccc}
.vote-status-info strong{color:#fff}
.btn-stop{background:#c0392b;color:#fff;border:none;border-radius:6px;padding:8px 16px;font-size:12px;font-weight:700;cursor:pointer;transition:background 0.2s}
.btn-stop:hover{background:#e74c3c}
.btn-start{background:#27ae60;color:#fff;border:none;border-radius:6px;padding:8px 16px;font-size:12px;font-weight:700;cursor:pointer}
.mvp-display{background:linear-gradient(135deg,#f39c12,#e67e22);border-radius:8px;padding:12px;text-align:center;margin-bottom:12px}
.mvp-display p{color:#fff;font-size:14px;font-weight:700}
/* VOTS */
.vg{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
.vc{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:9px}
.vn{color:#444;font-size:9px;letter-spacing:1px;text-transform:uppercase;margin-bottom:3px}
/* SUBMIT */
.submit-bar{position:fixed;bottom:0;left:0;right:0;background:rgba(17,17,17,0.97);border-top:1px solid #1e1e1e;padding:10px 22px;display:flex;align-items:center;justify-content:space-between;z-index:200;backdrop-filter:blur(10px)}
.btn-c{background:#1a1a1a;color:#777;border:1px solid #2a2a2a;border-radius:6px;padding:8px 16px;font-size:12px;cursor:pointer;text-decoration:none}
.btn-s{background:#00e676;color:#000;font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:2px;border:none;border-radius:6px;padding:8px 28px;cursor:pointer}
.btn-s:hover{background:#00c853}
/* LOGO PREVIEW */
.logo-preview-wrap{display:flex;gap:12px;align-items:center;margin-top:8px}
.logo-preview-img{width:60px;height:60px;object-fit:contain;border-radius:8px;border:1px solid #2a2a2a;background:#1a1a1a}
.pos-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:4px;width:90px}
.pos-btn{padding:5px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:4px;color:#777;font-size:10px;cursor:pointer;text-align:center;transition:all 0.2s}
.pos-btn.active{background:#00e676;color:#000;border-color:#00e676}
.size-sel{display:flex;gap:4px;margin-top:6px}
.size-btn{padding:4px 9px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:4px;color:#777;font-size:11px;cursor:pointer;transition:all 0.2s}
.size-btn.active{background:#00e676;color:#000;border-color:#00e676}
</style>
</head>
<body>
<header>
  <div class="logo">âš½ MATCHMAG</div>
  <a href="/admin" class="back">â† Dashboard</a>
</header>
<main>
<h1><%= mag ? 'EDITEAZÄ‚' : 'REVISTÄ‚ NOUÄ‚' %></h1>
<form method="POST" action="<%= mag ? '/admin/edit/'+mag.id : '/admin/new' %>" enctype="multipart/form-data" id="mf">

<div class="tabs">
  <button type="button" class="tab active" onclick="sp('info')">âš™ï¸ Info</button>
  <button type="button" class="tab" onclick="sp('p1')">P1 CopertÄƒ</button>
  <button type="button" class="tab" onclick="sp('p2')">P2 Cuprins</button>
  <button type="button" class="tab" onclick="sp('p34')">P3-4 Avancronica</button>
  <button type="button" class="tab" onclick="sp('p56')">P5-6 JucÄƒtor</button>
  <button type="button" class="tab" onclick="sp('p7')">P7 Clasament</button>
  <button type="button" class="tab" onclick="sp('p8')">P8 FormaÈ›ii</button>
  <button type="button" class="tab" onclick="sp('p9')">P9 Rezerve</button>
  <button type="button" class="tab" onclick="sp('p10')">P10 H2H</button>
  <button type="button" class="tab" onclick="sp('p11')">P11 Antrenori</button>
  <button type="button" class="tab" onclick="sp('p12')">P12 Palmares</button>
  <button type="button" class="tab" onclick="sp('p13')">P13 ReclamÄƒ</button>
  <button type="button" class="tab" onclick="sp('p14')">P14 Vot</button>
  <button type="button" class="tab" onclick="sp('p15')">P15 Promo</button>
  <button type="button" class="tab" onclick="sp('p16')">P16 Program</button>
</div>

<!-- INFO -->
<div class="panel active" id="panel-info">
  <div class="sec"><div class="sec-title">âš™ï¸ GENERAL</div>
    <div class="row2">
      <div class="f"><label>Echipa GazdÄƒ</label><input type="text" name="homeTeam" value="<%=mag?mag.homeTeam:''%>" required></div>
      <div class="f"><label>Echipa Oaspete</label><input type="text" name="awayTeam" value="<%=mag?mag.awayTeam:''%>" required></div>
    </div>
    <div class="row3">
      <div class="f"><label>Data</label><input type="date" name="matchDate" value="<%=mag?mag.matchDate:''%>"></div>
      <div class="f"><label>Stadion</label><input type="text" name="stadium" value="<%=mag?mag.stadium:''%>"></div>
      <div class="f"><label>CompetiÈ›ie</label><input type="text" name="competition" value="<%=mag?mag.competition:''%>"></div>
    </div>
  </div>

  <div class="sec"><div class="sec-title">ğŸ¨ CULORI GAZDE</div>
    <div class="hint">ğŸ’¡ BifeazÄƒ doar culorile pe care le foloseÈ™ti. Culoarea 1 e obligatorie.</div>
    <div class="color-row">
      <input type="color" name="homeColor1" value="<%=mag?mag.homeColor1:'#e63946'%>">
      <label>Culoare 1 (principalÄƒ â€“ obligatorie)</label>
    </div>
    <div class="color-row">
      <input type="color" name="homeColor2" value="<%=mag&&mag.homeColor2?mag.homeColor2:'#ffffff'%>" id="hc2col">
      <label>Culoare 2</label>
      <input type="checkbox" name="useHomeColor2" id="useHC2" <%=mag&&mag.homeColor2?'checked':''%> onchange="document.getElementById('hc2col').disabled=!this.checked">
    </div>
    <div class="color-row">
      <input type="color" name="homeColor3" value="<%=mag&&mag.homeColor3?mag.homeColor3:'#1d3557'%>" id="hc3col">
      <label>Culoare 3</label>
      <input type="checkbox" name="useHomeColor3" id="useHC3" <%=mag&&mag.homeColor3?'checked':''%> onchange="document.getElementById('hc3col').disabled=!this.checked">
    </div>
  </div>

  <div class="sec"><div class="sec-title">ğŸ¨ CULORI OASPETE</div>
    <div class="color-row">
      <input type="color" name="awayColor1" value="<%=mag?mag.awayColor1:'#457b9d'%>">
      <label>Culoare 1 (principalÄƒ â€“ obligatorie)</label>
    </div>
    <div class="color-row">
      <input type="color" name="awayColor2" value="<%=mag&&mag.awayColor2?mag.awayColor2:'#ffffff'%>" id="ac2col">
      <label>Culoare 2</label>
      <input type="checkbox" name="useAwayColor2" id="useAC2" <%=mag&&mag.awayColor2?'checked':''%> onchange="document.getElementById('ac2col').disabled=!this.checked">
    </div>
    <div class="color-row">
      <input type="color" name="awayColor3" value="<%=mag&&mag.awayColor3?mag.awayColor3:'#1d3557'%>" id="ac3col">
      <label>Culoare 3</label>
      <input type="checkbox" name="useAwayColor3" id="useAC3" <%=mag&&mag.awayColor3?'checked':''%> onchange="document.getElementById('ac3col').disabled=!this.checked">
    </div>
  </div>

  <div class="sec"><div class="sec-title">ğŸ–Œï¸ CULOARE FUNDAL REVISTÄ‚</div>
    <div class="row2">
      <div class="f"><label>Culoare Background</label><input type="color" name="bgColor" value="<%=mag?mag.bgColor||'#0d0d0d':'#0d0d0d'%>"></div>
      <div class="f"><label>Culoare Text pe Background</label><input type="color" name="bgTextColor" value="<%=mag?mag.bgTextColor||'#ffffff':'#ffffff'%>"></div>
    </div>
    <div class="hint">ğŸ’¡ Ex: background alb (#ffffff) + text negru (#000000). Sau background Ã®nchis + text alb.</div>
  </div>
</div>

<!-- P1 -->
<div class="panel" id="panel-p1">
  <div class="sec"><div class="sec-title">ğŸ“– COPERTÄ‚</div>
    <div class="f"><label>Titlu</label>
      <input type="text" name="coverTitle" value="<%=mag?mag.coverTitle:''%>" oninput="cc(this,40,'cc-ct')">
      <div class="cc" id="cc-ct">ghid: 40 caractere</div>
    </div>
    <div class="f"><label>Fotografie copertÄƒ (9:16 recomandat)</label>
      <%if(mag&&mag.cover){%><img src="<%=mag.cover%>" class="ci"><%}%>
      <div class="fu" onclick="document.getElementById('i-cover').click()">
        <input type="file" id="i-cover" name="cover" accept="image/*" onchange="sf(this,'fn-cover')">
        <div class="fu-lbl">ğŸ“· ÃncarcÄƒ fotografia de copertÄƒ</div>
        <div class="fn" id="fn-cover"><%=mag&&mag.cover?'âœ… ExistentÄƒ':''%></div>
      </div>
    </div>
  </div>

  <div class="sec"><div class="sec-title">ğŸŸï¸ EMBLEMÄ‚ CLUB (apare pe copertÄƒ + toate paginile)</div>
    <div class="f">
      <%if(mag&&mag.clubLogo){%><img src="<%=mag.clubLogo%>" style="width:70px;height:70px;object-fit:contain;border-radius:8px;border:1px solid #2a2a2a;background:#1a1a1a;display:block;margin-bottom:8px"><%}%>
      <div class="fu" onclick="document.getElementById('i-clogo').click()">
        <input type="file" id="i-clogo" name="clubLogo" accept="image/*" onchange="sf(this,'fn-clogo');previewLogo(this)">
        <div class="fu-lbl">ğŸ“· ÃncarcÄƒ emblema clubului (PNG cu fundal transparent ideal)</div>
        <div class="fn" id="fn-clogo"><%=mag&&mag.clubLogo?'âœ… ExistentÄƒ':''%></div>
      </div>
    </div>
    <div class="f"><label>PoziÈ›ie pe copertÄƒ</label>
      <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:4px">
        <% [['top-left','â†– Sus StÃ¢nga'],['top-center','â†‘ Sus Centru'],['top-right','â†— Sus Dreapta']].forEach(function(p){ %>
        <button type="button" class="pos-btn <%=(mag&&mag.logoPosition===p[0])||(!mag&&p[0]==='top-left')?'active':''%>" onclick="selPos('<%=p[0]%>')"><%=p[1]%></button>
        <% }) %>
      </div>
      <input type="hidden" name="logoPosition" id="logoPosVal" value="<%=mag?mag.logoPosition||'top-left':'top-left'%>">
    </div>
    <div class="f"><label>Dimensiune pe copertÄƒ</label>
      <div class="size-sel">
        <% [['small','MicÄƒ'],['medium','Medie'],['large','Mare']].forEach(function(s){ %>
        <button type="button" class="size-btn <%=(mag&&mag.logoSize===s[0])||(!mag&&s[0]==='medium')?'active':''%>" onclick="selSize('<%=s[0]%>')"><%=s[1]%></button>
        <% }) %>
      </div>
      <input type="hidden" name="logoSize" id="logoSizeVal" value="<%=mag?mag.logoSize||'medium':'medium'%>">
    </div>
  </div>
</div>

<!-- P2 TOC -->
<div class="panel" id="panel-p2">
  <div class="sec"><div class="sec-title">ğŸ“‹ CUPRINS</div>
    <div class="hint">ğŸ’¡ EditeazÄƒ titlurile. Cititorii pot apÄƒsa pe orice rÃ¢nd pentru a naviga direct.</div>
    <% const tocDefs=[
      {pg:'2',lbl:'Cuprins'},{pg:'3-4',lbl:'Avancronica'},{pg:'5-6',lbl:'JucÄƒtor Cheie'},
      {pg:'7',lbl:'Clasament'},{pg:'8',lbl:'FormaÈ›ii de Start'},{pg:'9',lbl:'Rezerve'},
      {pg:'10',lbl:'Head to Head'},{pg:'11',lbl:'Ce spun antrenorii'},{pg:'12',lbl:'Palmares'},
      {pg:'13',lbl:'ReclamÄƒ'},{pg:'14',lbl:'JucÄƒtorul Meciului'},{pg:'15',lbl:'Promo'},{pg:'16',lbl:'Program'}
    ]; %>
    <% const savedToc=mag&&mag.tocItems?mag.tocItems:[]; %>
    <% tocDefs.forEach(function(def,i){ %>
    <div class="toc-row">
      <div class="toc-pg"><%=def.pg%></div>
      <input type="text" name="tocItem" value="<%=savedToc[i]||def.lbl%>" placeholder="<%=def.lbl%>">
    </div>
    <% }) %>
  </div>
</div>

<!-- P3-4 -->
<div class="panel" id="panel-p34">
  <div class="sec"><div class="sec-title">ğŸ“ AVANCRONICA</div>
    <div class="f"><label>Titlu</label><input type="text" name="avancronicaTitle" value="<%=mag?mag.avancronicaTitle:'Avancronica'%>"></div>
    <div class="f"><label>Pagina 3</label><textarea name="avancronicaP1" rows="8" oninput="cc(this,600,'cc-ap1')"><%=mag?mag.avancronicaP1:''%></textarea><div class="cc" id="cc-ap1">ghid: 600 caractere</div></div>
    <div class="f"><label>Pagina 4</label><textarea name="avancronicaP2" rows="8" oninput="cc(this,600,'cc-ap2')"><%=mag?mag.avancronicaP2:''%></textarea><div class="cc" id="cc-ap2">ghid: 600 caractere</div></div>
  </div>
</div>

<!-- P5-6 -->
<div class="panel" id="panel-p56">
  <div class="sec"><div class="sec-title">â­ JUCÄ‚TOR CHEIE</div>
    <div class="f"><label>Fotografie</label>
      <%if(mag&&mag.playerPhoto){%><img src="<%=mag.playerPhoto%>" class="ci"><%}%>
      <div class="fu" onclick="document.getElementById('i-pl').click()">
        <input type="file" id="i-pl" name="playerPhoto" accept="image/*" onchange="sf(this,'fn-pl')">
        <div class="fu-lbl">ğŸ“· Portret jucÄƒtor</div>
        <div class="fn" id="fn-pl"><%=mag&&mag.playerPhoto?'âœ… ExistentÄƒ':''%></div>
      </div>
    </div>
    <div class="row2">
      <div class="f"><label>Nume jucÄƒtor</label><input type="text" name="playerTitle" value="<%=mag?mag.playerTitle:''%>" oninput="cc(this,30,'cc-pn')"><div class="cc" id="cc-pn">ghid: 30</div></div>
      <div class="f"><label>Subtitlu / PoziÈ›ie</label><input type="text" name="playerSubtitle" value="<%=mag?mag.playerSubtitle:''%>" oninput="cc(this,60,'cc-ps')"><div class="cc" id="cc-ps">ghid: 60</div></div>
    </div>
    <div class="f"><label>Text</label><textarea name="playerText" rows="8" oninput="cc(this,600,'cc-ptx')"><%=mag?mag.playerText:''%></textarea><div class="cc" id="cc-ptx">ghid: 600 caractere</div></div>
  </div>
</div>

<!-- P7 -->
<div class="panel" id="panel-p7">
  <div class="sec"><div class="sec-title">ğŸ† CLASAMENT</div>
    <div class="f"><label>Titlu</label><input type="text" name="standingsTitle" value="<%=mag?mag.standingsTitle:'Clasament'%>"></div>
    <div class="hint">ğŸ’¡ Recomandat: <strong>SofaScore</strong> pentru embed mai curat pe mobil. Mergi la sofascore.com â†’ Liga â†’ Clasament â†’ Share â†’ Embed. Alternativ Flashscore.</div>
    <div class="f"><label>Cod Embed</label><textarea name="standingsEmbed" rows="4"><%=mag?mag.standingsEmbed:''%></textarea></div>
  </div>
</div>

<!-- P8 FORMATIONS -->
<div class="panel" id="panel-p8">
  <div class="sec"><div class="sec-title">âš½ FORMAÈšII â€“ GAZDE</div>
    <div class="row2">
      <div class="f"><label>Titlu</label><input type="text" name="homeFormationTitle" value="<%=mag?mag.homeFormationTitle:''%>"></div>
      <div class="f"><label>Logo</label>
        <%if(mag&&mag.homeLogoPhoto){%><img src="<%=mag.homeLogoPhoto%>" class="ci" style="max-height:44px;object-fit:contain"><%}%>
        <div class="fu" onclick="document.getElementById('i-hl').click()" style="padding:8px">
          <input type="file" id="i-hl" name="homeLogoPhoto" accept="image/*" onchange="sf(this,'fn-hl')">
          <div class="fu-lbl" style="font-size:10px">ğŸ“· Logo</div>
          <div class="fn" id="fn-hl"><%=mag&&mag.homeLogoPhoto?'âœ…':''%></div>
        </div>
      </div>
    </div>
    <div class="f"><label>FormaÈ›ie</label>
      <div class="form-sel" id="homeFrmSel">
        <%['4-3-3','4-4-2','4-2-3-1','3-4-3','4-1-4-1','5-4-1','5-3-2'].forEach(f=>{%>
          <button type="button" class="fb <%-((mag&&mag.homeFormation===f)||(!mag&&f==='4-3-3'))?'active':''%>" onclick="selForm('home','<%=f%>')"><%=f%></button>
        <%})%>
      </div>
      <input type="hidden" name="homeFormation" id="homeFormVal" value="<%=mag?mag.homeFormation:'4-3-3'%>">
    </div>
    <div id="homePitch"></div>
  </div>
  <div class="sec"><div class="sec-title">âš½ FORMAÈšII â€“ OASPETE</div>
    <div class="row2">
      <div class="f"><label>Titlu</label><input type="text" name="awayFormationTitle" value="<%=mag?mag.awayFormationTitle:''%>"></div>
      <div class="f"><label>Logo</label>
        <%if(mag&&mag.awayLogoPhoto){%><img src="<%=mag.awayLogoPhoto%>" class="ci" style="max-height:44px;object-fit:contain"><%}%>
        <div class="fu" onclick="document.getElementById('i-al').click()" style="padding:8px">
          <input type="file" id="i-al" name="awayLogoPhoto" accept="image/*" onchange="sf(this,'fn-al')">
          <div class="fu-lbl" style="font-size:10px">ğŸ“· Logo</div>
          <div class="fn" id="fn-al"><%=mag&&mag.awayLogoPhoto?'âœ…':''%></div>
        </div>
      </div>
    </div>
    <div class="f"><label>FormaÈ›ie</label>
      <div class="form-sel" id="awayFrmSel">
        <%['4-3-3','4-4-2','4-2-3-1','3-4-3','4-1-4-1','5-4-1','5-3-2'].forEach(f=>{%>
          <button type="button" class="fb <%-((mag&&mag.awayFormation===f)||(!mag&&f==='4-3-3'))?'active':''%>" onclick="selForm('away','<%=f%>')"><%=f%></button>
        <%})%>
      </div>
      <input type="hidden" name="awayFormation" id="awayFormVal" value="<%=mag?mag.awayFormation:'4-3-3'%>">
    </div>
    <div id="awayPitch"></div>
  </div>
</div>

<!-- P9 -->
<div class="panel" id="panel-p9">
  <div class="sec"><div class="sec-title">ğŸ“‹ REZERVE</div>
    <div class="row2">
      <div class="f"><label>Rezerve Gazde</label><textarea name="homeReserves" rows="10" placeholder="12. Nume&#10;13. Nume..."><%=mag?mag.homeReserves:''%></textarea></div>
      <div class="f"><label>Rezerve Oaspete</label><textarea name="awayReserves" rows="10" placeholder="12. Nume&#10;13. Nume..."><%=mag?mag.awayReserves:''%></textarea></div>
    </div>
  </div>
</div>

<!-- P10 H2H -->
<div class="panel" id="panel-p10">
  <div class="sec"><div class="sec-title">ğŸ“Š HEAD TO HEAD</div>
    <div class="f"><label>Titlu</label><input type="text" name="h2hTitle" value="<%=mag?mag.h2hTitle:'ÃntÃ¢lniri directe'%>"></div>
    <div id="h2hRows">
      <% const h2hL=mag&&mag.h2hLabels?mag.h2hLabels:['Victorii gazde','Egal','Victorii oaspete']; %>
      <% const h2hV=mag&&mag.h2hValues?mag.h2hValues:['0','0','0']; %>
      <% h2hL.forEach(function(lbl,i){ %>
      <div class="h2h-row" id="h2hr-<%=i%>">
        <input type="text" name="h2hLabel" value="<%=lbl%>" placeholder="Label">
        <input type="text" name="h2hValue" value="<%=h2hV[i]||''%>" placeholder="0">
        <button type="button" class="btn-rem" onclick="remH2H(<%=i%>)">âœ•</button>
      </div>
      <% }) %>
    </div>
    <button type="button" class="btn-add" onclick="addH2H()" style="margin-top:8px">+ AdaugÄƒ rÃ¢nd</button>
    <div class="f" style="margin-top:12px"><label>Embed YouTube</label><textarea name="h2hYoutubeEmbed" rows="3"><%=mag?mag.h2hYoutubeEmbed:''%></textarea></div>
  </div>
</div>

<!-- P11 -->
<div class="panel" id="panel-p11">
  <div class="sec"><div class="sec-title">ğŸ’¬ CE SPUN ANTRENORII</div>
    <div class="f"><label>Titlu secÈ›iune</label><input type="text" name="coachesTitle" value="<%=mag?mag.coachesTitle:'Ce spun antrenorii'%>"></div>
    <div class="row2">
      <div class="f">
        <label style="color:#c0392b">â–¶ ANTRENOR GAZDE</label>
        <%if(mag&&mag.homeCoachPhoto){%><img src="<%=mag.homeCoachPhoto%>" class="ci" style="max-height:80px;object-fit:cover;border-radius:6px;border:2px solid #c0392b"><%}%>
        <div class="fu" onclick="document.getElementById('i-hc').click()" style="padding:9px">
          <input type="file" id="i-hc" name="homeCoachPhoto" accept="image/*" onchange="sf(this,'fn-hc')">
          <div class="fu-lbl" style="font-size:10px">ğŸ“· PozÄƒ antrenor</div>
          <div class="fn" id="fn-hc"><%=mag&&mag.homeCoachPhoto?'âœ…':''%></div>
        </div>
        <div class="f" style="margin-top:8px"><label>Nume</label><input type="text" name="homeCoachName" value="<%=mag?mag.homeCoachName:''%>"></div>
        <div class="f"><label>DeclaraÈ›ie</label><textarea name="homeCoachText" rows="5" oninput="cc(this,300,'cc-hct')"><%=mag?mag.homeCoachText:''%></textarea><div class="cc" id="cc-hct">ghid: 300</div></div>
      </div>
      <div class="f">
        <label style="color:#27ae60">â–¶ ANTRENOR OASPETE</label>
        <%if(mag&&mag.awayCoachPhoto){%><img src="<%=mag.awayCoachPhoto%>" class="ci" style="max-height:80px;object-fit:cover;border-radius:6px;border:2px solid #27ae60"><%}%>
        <div class="fu" onclick="document.getElementById('i-ac').click()" style="padding:9px">
          <input type="file" id="i-ac" name="awayCoachPhoto" accept="image/*" onchange="sf(this,'fn-ac')">
          <div class="fu-lbl" style="font-size:10px">ğŸ“· PozÄƒ antrenor</div>
          <div class="fn" id="fn-ac"><%=mag&&mag.awayCoachPhoto?'âœ…':''%></div>
        </div>
        <div class="f" style="margin-top:8px"><label>Nume</label><input type="text" name="awayCoachName" value="<%=mag?mag.awayCoachName:''%>"></div>
        <div class="f"><label>DeclaraÈ›ie</label><textarea name="awayCoachText" rows="5" oninput="cc(this,300,'cc-act')"><%=mag?mag.awayCoachText:''%></textarea><div class="cc" id="cc-act">ghid: 300</div></div>
      </div>
    </div>
  </div>
</div>

<!-- P12 -->
<div class="panel" id="panel-p12">
  <div class="sec"><div class="sec-title">ğŸ… PALMARES</div>
    <div class="f"><label>Titlu</label><input type="text" name="palmaresTitle" value="<%=mag?mag.palmaresTitle:'Palmares'%>"></div>
    <div class="f"><label>Fotografie portret</label>
      <%if(mag&&mag.palmaresPhoto){%><img src="<%=mag.palmaresPhoto%>" class="ci"><%}%>
      <div class="fu" onclick="document.getElementById('i-palm').click()">
        <input type="file" id="i-palm" name="palmaresPhoto" accept="image/*" onchange="sf(this,'fn-palm')">
        <div class="fu-lbl">ğŸ“· PozÄƒ portret (jucÄƒtor cu trofeu)</div>
        <div class="fn" id="fn-palm"><%=mag&&mag.palmaresPhoto?'âœ… ExistentÄƒ':''%></div>
      </div>
    </div>
    <div class="f"><label>Text</label><textarea name="palmaresText" rows="8" oninput="cc(this,800,'cc-palm')"><%=mag?mag.palmaresText:''%></textarea><div class="cc" id="cc-palm">ghid: 800 caractere</div></div>
  </div>
</div>

<!-- P13 -->
<div class="panel" id="panel-p13">
  <div class="sec"><div class="sec-title">ğŸ“¢ RECLAMÄ‚</div>
    <div class="f"><label>Titlu (opÈ›ional)</label><input type="text" name="adTitle" value="<%=mag?mag.adTitle:''%>"></div>
    <div class="f"><label>Cod Embed</label><textarea name="adEmbed" rows="5"><%=mag?mag.adEmbed:''%></textarea></div>
  </div>
</div>

<!-- P14 VOTE -->
<div class="panel" id="panel-p14">
  <% if(mag) { %>
  <div class="sec"><div class="sec-title">ğŸ›ï¸ CONTROL VOT LIVE</div>
    <% if(mag.voteStopped) { %>
    <div class="mvp-display"><p>ğŸ† Votul s-a Ã®ncheiat Â· MVP: <strong><%=mag.mvp||'â€“'%></strong></p></div>
    <div class="vote-status">
      <div class="vote-status-info">Votul este <strong>OPRIT</strong>. MVP afiÈ™at cititorilor.</div>
      <button type="button" class="btn-start" onclick="startVote()">â–¶ Redeschide vot</button>
    </div>
    <% } else { %>
    <div class="vote-status">
      <div class="vote-status-info">Votul este <strong>ACTIV</strong> Â· ApasÄƒ Stop cÃ¢nd meciul se terminÄƒ</div>
      <button type="button" class="btn-stop" onclick="stopVote()">â¹ STOP VOT</button>
    </div>
    <% } %>
  </div>
  <% } %>
  <div class="sec"><div class="sec-title">ğŸ—³ï¸ CANDIDAÈšI</div>
    <div class="vg">
      <div class="vc"><div class="vn">Candidat 1</div><input type="text" name="voteCandidate0" value="<%=mag?mag.voteCandidate0:''%>" placeholder="Nume jucÄƒtor"></div>
      <div class="vc"><div class="vn">Candidat 2</div><input type="text" name="voteCandidate1" value="<%=mag?mag.voteCandidate1:''%>" placeholder="Nume jucÄƒtor"></div>
      <div class="vc"><div class="vn">Candidat 3</div><input type="text" name="voteCandidate2" value="<%=mag?mag.voteCandidate2:''%>" placeholder="Nume jucÄƒtor"></div>
    </div>
  </div>
</div>

<!-- P15 -->
<div class="panel" id="panel-p15">
  <div class="sec"><div class="sec-title">ğŸ“£ BANNER PROMO</div>
    <div class="hint">ğŸ’¡ Introdu codul embed de la casa de pariuri sau sponsor (banner orizontal)</div>
    <div class="f"><label>Cod Embed Banner</label><textarea name="promoEmbed" rows="5"><%=mag?mag.promoEmbed:''%></textarea></div>
  </div>
</div>

<!-- P16 -->
<div class="panel" id="panel-p16">
  <div class="sec"><div class="sec-title">ğŸŸï¸ PROGRAM</div>
    <div class="f"><label>Fotografie landscape</label>
      <%if(mag&&mag.stadiumPhoto){%><img src="<%=mag.stadiumPhoto%>" class="ci"><%}%>
      <div class="fu" onclick="document.getElementById('i-stad').click()">
        <input type="file" id="i-stad" name="stadiumPhoto" accept="image/*" onchange="sf(this,'fn-stad')">
        <div class="fu-lbl">ğŸ“· Fotografie stadion / program</div>
        <div class="fn" id="fn-stad"><%=mag&&mag.stadiumPhoto?'âœ… ExistentÄƒ':''%></div>
      </div>
    </div>
    <div class="f"><label>Titlu</label><input type="text" name="programTitle" value="<%=mag?mag.programTitle:'Programul echipei noastre'%>"></div>
    <div class="f"><label>Text</label><textarea name="programText" rows="6" oninput="cc(this,400,'cc-prog')"><%=mag?mag.programText:''%></textarea><div class="cc" id="cc-prog">ghid: 400 caractere</div></div>
  </div>
</div>

<div id="hiddenPlayers"></div>

<div class="submit-bar">
  <span style="color:#444;font-size:11px">16 pagini Â· emblema club Â· vot live</span>
  <div style="display:flex;gap:8px">
    <a href="/admin" class="btn-c">AnuleazÄƒ</a>
    <button type="submit" class="btn-s">ğŸ’¾ SALVEAZÄ‚</button>
  </div>
</div>
</form>
</main>

<script>
const MAG_ID='<%=mag?mag.id:null%>';
const FORMATIONS={
  '4-3-3':[[1],[4,3,2,5],[8,6,10],[9,7,11]],
  '4-4-2':[[1],[2,3,4,5],[6,7,8,9],[10,11]],
  '4-2-3-1':[[1],[2,3,4,5],[6,8],[7,10,11],[9]],
  '3-4-3':[[1],[2,5,3],[4,6,8,7],[9,10,11]],
  '4-1-4-1':[[1],[2,3,4,5],[6],[7,8,9,10],[11]],
  '5-4-1':[[1],[2,3,5,4,6],[7,8,9,10],[11]],
  '5-3-2':[[1],[2,3,5,4,6],[7,8,9],[10,11]]
};
const eHN=<%- JSON.stringify(mag&&mag.homePlayerNumbers?mag.homePlayerNumbers:Array(11).fill('')) %>;
const eHNm=<%- JSON.stringify(mag&&mag.homePlayerNames?mag.homePlayerNames:Array(11).fill('')) %>;
const eAN=<%- JSON.stringify(mag&&mag.awayPlayerNumbers?mag.awayPlayerNumbers:Array(11).fill('')) %>;
const eANm=<%- JSON.stringify(mag&&mag.awayPlayerNames?mag.awayPlayerNames:Array(11).fill('')) %>;
let hD={nums:[...eHN],names:[...eHNm]};
let aD={nums:[...eAN],names:[...eANm]};

function sp(id){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('panel-'+id).classList.add('active');
  event.target.classList.add('active');
  if(id==='p8'){renderPitch('home');renderPitch('away');}
}
function selForm(team,f){
  document.getElementById(team+'FormVal').value=f;
  document.querySelectorAll('#'+team+'FrmSel .fb').forEach(b=>b.classList.toggle('active',b.textContent===f));
  renderPitch(team);
}
function renderPitch(team){
  const f=document.getElementById(team+'FormVal').value;
  const rows=FORMATIONS[f]||FORMATIONS['4-3-3'];
  const d=team==='home'?hD:aD;
  const col=team==='home'?'#c0392b':'#27ae60';
  const cls=team==='home'?'home-pa':'away-pa';
  const rev=[...rows].reverse();
  let idx=0,html=`<div class="pitch-a ${cls}">`;
  rev.forEach(row=>{
    html+=`<div class="prow">`;
    row.forEach(()=>{
      const n=d.nums[idx]||'';const nm=d.names[idx]||'';const i=idx;
      html+=`<div class="pa"><div class="pinputs">
        <input class="ni" type="text" placeholder="#" value="${n.replace(/"/g,'&quot;')}" maxlength="2" oninput="upd('${team}',${i},'n',this.value)">
        <input class="nmi" type="text" placeholder="Nume" value="${nm.replace(/"/g,'&quot;')}" oninput="upd('${team}',${i},'nm',this.value)">
      </div></div>`;
      idx++;
    });
    html+=`</div>`;
  });
  html+=`</div>`;
  document.getElementById(team+'Pitch').innerHTML=html;
  syncH();
}
function upd(team,idx,field,val){const d=team==='home'?hD:aD;if(field==='n')d.nums[idx]=val;else d.names[idx]=val;syncH();}
function syncH(){
  let h='';
  for(let i=0;i<11;i++){
    h+=`<input type="hidden" name="homeNumber_${i}" value="${(hD.nums[i]||'').replace(/"/g,'&quot;')}">`;
    h+=`<input type="hidden" name="homeName_${i}" value="${(hD.names[i]||'').replace(/"/g,'&quot;')}">`;
    h+=`<input type="hidden" name="awayNumber_${i}" value="${(aD.nums[i]||'').replace(/"/g,'&quot;')}">`;
    h+=`<input type="hidden" name="awayName_${i}" value="${(aD.names[i]||'').replace(/"/g,'&quot;')}">`;
  }
  document.getElementById('hiddenPlayers').innerHTML=h;
}
let h2hCount=document.querySelectorAll('.h2h-row').length;
function addH2H(){
  const c=document.getElementById('h2hRows');
  const d=document.createElement('div');d.className='h2h-row';d.id='h2hr-'+h2hCount;
  d.innerHTML=`<input type="text" name="h2hLabel" placeholder="Label"><input type="text" name="h2hValue" placeholder="0"><button type="button" class="btn-rem" onclick="remH2H(${h2hCount})">âœ•</button>`;
  c.appendChild(d);h2hCount++;
}
function remH2H(i){const el=document.getElementById('h2hr-'+i);if(el&&document.querySelectorAll('.h2h-row').length>1)el.remove();}
function sf(input,nameId){if(input.files&&input.files[0])document.getElementById(nameId).textContent='âœ… '+input.files[0].name;}
function cc(el,guide,id){
  const len=el.value.length,el2=document.getElementById(id);
  if(!el2)return;
  el2.textContent=`${len} caractere (ghid: ${guide})`;
  el2.className='cc'+(len>guide*1.5?' warn':'');
}
function selPos(p){
  document.getElementById('logoPosVal').value=p;
  document.querySelectorAll('.pos-btn').forEach(b=>b.classList.toggle('active',b.onclick.toString().includes("'"+p+"'")));
}
function selSize(s){
  document.getElementById('logoSizeVal').value=s;
  document.querySelectorAll('.size-btn').forEach(b=>b.classList.toggle('active',b.onclick.toString().includes("'"+s+"'")));
}
function previewLogo(input){
  if(input.files&&input.files[0]){
    const r=new FileReader();r.onload=e=>{
      let img=document.querySelector('.logo-preview-img');
      if(!img){img=document.createElement('img');img.className='logo-preview-img';input.closest('.fu').before(img);}
      img.src=e.target.result;
    };r.readAsDataURL(input.files[0]);
  }
}
// VOTE CONTROL
function stopVote(){
  if(!MAG_ID||!confirm('OpreÈ™ti votul? MVP va fi afiÈ™at automat.'))return;
  fetch(`/admin/stop-vote/${MAG_ID}`,{method:'POST'}).then(r=>r.json()).then(d=>{
    if(d.success)location.reload();
  });
}
function startVote(){
  if(!MAG_ID)return;
  fetch(`/admin/start-vote/${MAG_ID}`,{method:'POST'}).then(r=>r.json()).then(d=>{
    if(d.success)location.reload();
  });
}
syncH();
</script>
</body>
</html>
