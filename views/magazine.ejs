<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title><%= mag.homeTeam %> vs <%= mag.awayTeam %></title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;600;700&family=Source+Sans+3:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --h1:<%=mag.homeColor1%>;
  --h2:<%=mag.homeColor2||mag.homeColor1%>;
  --h3:<%=mag.homeColor3||mag.homeColor1%>;
  --a1:<%=mag.awayColor1%>;
  --a2:<%=mag.awayColor2||mag.awayColor1%>;
  --a3:<%=mag.awayColor3||mag.awayColor1%>;
  --bg:<%=mag.bgColor||'#0d0d0d'%>;
  --fg:<%=mag.bgTextColor||'#ffffff'%>;
  --card:<%=mag.bgColor==='#ffffff'||mag.bgColor==='#fff'?'#f0f0f0':'#141414'%>;
  --border:<%=mag.bgColor==='#ffffff'||mag.bgColor==='#fff'?'#ddd':'#1e1e1e'%>;
  --muted:<%=mag.bgColor==='#ffffff'||mag.bgColor==='#fff'?'#666':'#666'%>;
  --text-on-bg:<%=mag.bgTextColor||'#ffffff'%>;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;overflow:hidden;background:var(--bg);font-family:'Source Sans 3',sans-serif;touch-action:none;color:var(--fg)}
.magazine{width:100%;height:100vh;display:flex;will-change:transform}
.page{min-width:100vw;width:100vw;height:100vh;overflow-y:auto;overflow-x:hidden;position:relative;scrollbar-width:none;-webkit-overflow-scrolling:touch;background:var(--bg)}
.page::-webkit-scrollbar{display:none}

/* CLUB LOGO BUTTON (replaces home btn) */
.club-logo-btn{position:absolute;top:8px;left:10px;z-index:50;cursor:pointer;display:flex;align-items:center;gap:6px;background:rgba(0,0,0,0.35);border:1px solid rgba(255,255,255,0.12);padding:4px 10px 4px 5px;border-radius:20px;backdrop-filter:blur(6px);transition:background 0.2s}
.club-logo-btn:hover{background:rgba(255,255,255,0.15)}
.club-logo-img{width:28px;height:28px;object-fit:contain;border-radius:50%}
.club-logo-ph{width:28px;height:28px;border-radius:50%;background:var(--h1);display:flex;align-items:center;justify-content:center;font-size:13px}
.club-logo-label{font-size:10px;color:rgba(255,255,255,0.8);letter-spacing:1px;font-weight:600}

/* NAV */
.nav-dots{position:fixed;bottom:12px;left:50%;transform:translateX(-50%);display:flex;gap:4px;z-index:100;background:rgba(0,0,0,0.5);padding:4px 9px;border-radius:18px;backdrop-filter:blur(8px)}
.dot{width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,0.2);transition:all 0.3s;cursor:pointer}
.dot.active{background:#fff;width:14px;border-radius:3px}
.arrow{position:fixed;top:50%;transform:translateY(-50%);width:30px;height:30px;border-radius:50%;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.1);color:#fff;font-size:17px;cursor:pointer;z-index:100;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px);user-select:none;transition:background 0.2s}
.arrow:hover{background:rgba(255,255,255,0.15)}
.arrow-left{left:4px}.arrow-right{right:4px}
.arrow.hidden{opacity:0;pointer-events:none}
.page-num{position:fixed;top:10px;right:10px;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.1);color:rgba(255,255,255,0.4);font-size:10px;letter-spacing:1px;padding:3px 8px;border-radius:8px;z-index:100;backdrop-filter:blur(4px)}

/* COVER */
.cover-page{position:relative;display:flex;flex-direction:column;justify-content:flex-end;min-height:100vh;background:#111}
.cover-photo{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;object-position:center top}
.cover-overlay{position:absolute;inset:0;background:linear-gradient(to bottom,rgba(0,0,0,0.05) 0%,rgba(0,0,0,0.88) 100%)}
.cover-no-photo{position:absolute;inset:0;background:linear-gradient(135deg,var(--h1) 0%,#111 45%,var(--a1) 100%);opacity:0.4}
.cover-club-logo{position:absolute;z-index:5;object-fit:contain}
.cover-club-logo.pos-top-left{top:16px;left:16px}
.cover-club-logo.pos-top-center{top:16px;left:50%;transform:translateX(-50%)}
.cover-club-logo.pos-top-right{top:16px;right:16px}
.cover-club-logo.size-small{width:50px;height:50px}
.cover-club-logo.size-medium{width:80px;height:80px}
.cover-club-logo.size-large{width:110px;height:110px}
.cover-content{position:relative;z-index:2;padding:20px 20px 72px}
.cover-comp{display:inline-block;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);color:rgba(255,255,255,0.8);font-size:10px;letter-spacing:2px;text-transform:uppercase;padding:3px 10px;border-radius:16px;margin-bottom:10px}
.cover-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(26px,8vw,42px);letter-spacing:3px;line-height:1.1;color:#fff;text-shadow:0 2px 20px rgba(0,0,0,0.9);margin-bottom:6px}
.cover-meta{color:rgba(255,255,255,0.4);font-size:12px}
.color-bar{height:4px;background:linear-gradient(to right,var(--h1) 50%,var(--a1) 50%)}

/* TOC */
.toc-page{padding:10px 0 70px;min-height:100vh}
.toc-header{padding:44px 18px 10px}
.toc-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;color:var(--fg)}
.toc-subtitle{color:var(--muted);font-size:10px;letter-spacing:1px;margin-top:1px}
.toc-list{padding:0 10px}
.toc-item{display:flex;align-items:center;padding:0;border-bottom:1px solid var(--border);cursor:pointer;transition:background 0.15s;border-radius:6px;margin-bottom:2px;overflow:hidden}
.toc-item:hover,.toc-item:active{background:var(--card)}
.toc-num{font-family:'Bebas Neue',sans-serif;font-size:20px;color:rgba(128,128,128,0.3);width:40px;text-align:center;padding:8px 0;flex-shrink:0}
.toc-text{flex:1;font-size:13px;color:var(--fg);opacity:0.7;padding:8px 8px;font-weight:600}
.toc-arrow{color:var(--muted);font-size:14px;padding-right:12px;flex-shrink:0}
.toc-item.current .toc-num{color:var(--h1)}
.toc-item.current .toc-text{opacity:1}
.toc-item.current{background:var(--card)}

/* GENERIC PAGE */
.pg{padding:44px 18px 70px}
.pg-label{color:var(--muted);font-size:10px;letter-spacing:2px;text-transform:uppercase;margin-bottom:3px}
.pg-subtitle{font-family:'Oswald',sans-serif;font-size:22px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--fg);border-left:4px solid var(--h1);padding-left:10px;margin-bottom:14px}
.pg-body{font-size:15px;line-height:1.85;color:var(--fg);opacity:0.85;white-space:pre-wrap}

/* PLAYER */
.player-area{display:flex;gap:12px;padding:44px 16px 12px;align-items:flex-start}
.player-photo{width:100px;height:134px;object-fit:cover;object-position:top;border-radius:8px;flex-shrink:0;border:2px solid var(--h1)}
.player-photo-ph{width:100px;height:134px;border-radius:8px;flex-shrink:0;background:linear-gradient(135deg,var(--h1)33,var(--h3)33);border:2px solid var(--h1);display:flex;align-items:center;justify-content:center;font-size:32px}
.player-info{flex:1;padding-top:4px}
.player-name{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--fg);line-height:1;margin-bottom:8px}
.player-sub{display:inline-block;font-size:13px;font-weight:700;letter-spacing:0.5px;color:#fff;background:linear-gradient(135deg,var(--h1),var(--h3));padding:4px 11px;border-radius:5px;box-shadow:0 3px 10px rgba(0,0,0,0.4);text-shadow:0 1px 2px rgba(0,0,0,0.4);line-height:1.4}
.divider{height:1px;background:var(--border);margin:0 16px}

/* STANDINGS */
.standings-page{padding:44px 0 70px}
.standings-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;color:var(--fg);margin-bottom:12px;padding:0 16px}
.standings-wrap{width:100%;overflow:hidden;border-radius:8px;background:#fff}
.standings-wrap iframe{display:block;width:100%;border:none;margin-top:-120px}
.standings-ph{background:var(--card);border:1px solid var(--border);border-radius:8px;height:160px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:13px;margin:0 16px}

/* FORMATIONS */
.formations-page{padding:44px 10px 70px;background:#f0f0f0;min-height:100vh}
.team-section{margin-bottom:16px}
.team-hdr{display:flex;align-items:center;gap:8px;margin-bottom:8px;padding:7px 9px;border-radius:6px;background:rgba(0,0,0,0.04);border:1px solid rgba(0,0,0,0.1)}
.team-logo{width:36px;height:36px;object-fit:contain;flex-shrink:0}
.team-logo-ph{width:36px;height:36px;border-radius:4px;background:#ddd;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.team-title{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:1px;flex:1;line-height:1}
.team-formation-lbl{font-size:10px;color:#999;letter-spacing:1px}
.pitch{background:#fff;border:2px solid #333;position:relative;padding:8px 4px}
.pitch.home-pitch{border-color:#c0392b}
.pitch.away-pitch{border-color:#27ae60;margin-top:4px}
.pitch-inner{position:relative}
.penalty-box-top{position:absolute;top:0;left:50%;transform:translateX(-50%);width:55%;height:18%;border:1.5px solid rgba(0,0,0,0.15);border-top:none;pointer-events:none;z-index:1}
.penalty-box-bot{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:55%;height:18%;border:1.5px solid rgba(0,0,0,0.15);border-bottom:none;pointer-events:none;z-index:1}
.mid-line{height:1px;background:rgba(0,0,0,0.12);margin:3px 0}
.pitch-row{display:flex;justify-content:space-around;margin-bottom:4px;position:relative;z-index:2}
.player-token{display:flex;flex-direction:column;align-items:center;gap:2px}
.shirt-wrap{position:relative;width:32px;height:36px}
.shirt-wrap svg{width:100%;height:100%}
.shirt-num{position:absolute;top:50%;left:50%;transform:translate(-50%,-44%);font-size:10px;font-weight:900;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,0.5);line-height:1;text-align:center;pointer-events:none}
.shirt-num.dark{color:#222;text-shadow:none}
.token-name{font-size:9px;color:#111;text-align:center;max-width:44px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:700}

/* RESERVES */
.reserves-page{min-height:100vh;display:flex;flex-direction:column}
.reserves-hdr{padding:44px 16px 10px}
.reserves-hdr-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;color:var(--fg)}
.reserves-body{display:flex;flex:1}
.res-col{flex:1;padding:12px 10px 70px}
.res-col.home-col{border-right:2px solid #c0392b}
.res-col-title{font-family:'Oswald',sans-serif;font-size:12px;font-weight:700;letter-spacing:1px;text-transform:uppercase;padding-bottom:7px;margin-bottom:8px}
.res-text{color:var(--fg);opacity:0.8;font-size:13px;line-height:2;white-space:pre-wrap}

/* H2H */
.h2h-page{padding:44px 16px 70px}
.h2h-title{font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:2px;color:var(--fg);margin-bottom:16px;line-height:1.1}
.h2h-rows{display:flex;flex-direction:column;margin-bottom:18px;border-radius:8px;overflow:hidden;border:1px solid var(--border)}
.h2h-row{display:flex;align-items:center;padding:13px 14px;border-bottom:1px solid var(--border);background:var(--card)}
.h2h-row:last-child{border-bottom:none}
.h2h-label{flex:1;font-size:15px;color:var(--fg);font-weight:600}
.h2h-value{font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--fg);min-width:44px;text-align:right}
.h2h-label.home-label{color:var(--h1);filter:brightness(1.2)}
.h2h-label.away-label{color:var(--a1);filter:brightness(1.2)}
.h2h-video{width:100%;aspect-ratio:16/9;border-radius:8px;overflow:hidden;background:#111}
.h2h-video iframe{width:100%;height:100%;border:none}

/* COACHES */
.coaches-page{padding:44px 16px 70px}
.coaches-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--fg);margin-bottom:16px}
.coaches-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px}
.coach-card{background:var(--card);border:1px solid var(--border);border-radius:10px;overflow:hidden;display:flex;flex-direction:column;align-items:center;padding:14px 10px 12px}
.coach-photo{width:80px;height:100px;object-fit:cover;object-position:top;border-radius:7px;border:2px solid var(--h1);margin-bottom:8px}
.coach-photo.away{border-color:var(--a1)}
.coach-photo-ph{width:80px;height:100px;border-radius:7px;background:linear-gradient(135deg,var(--h1)22,#111);border:2px solid var(--h1);display:flex;align-items:center;justify-content:center;font-size:28px;margin-bottom:8px}
.coach-photo-ph.away{border-color:var(--a1);background:linear-gradient(135deg,var(--a1)22,#111)}
.coach-name{font-family:'Oswald',sans-serif;font-size:14px;font-weight:700;color:var(--fg);text-align:center;letter-spacing:0.5px;margin-bottom:4px}
.coach-team{font-size:10px;color:var(--muted);text-align:center;letter-spacing:1px;text-transform:uppercase}
.coaches-texts{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.coach-text-block{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:12px}
.coach-text-label{font-size:10px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:6px}
.coach-text{font-size:14px;line-height:1.7;color:var(--fg);opacity:0.8;white-space:pre-wrap}

/* PALMARES */
.palmares-page{padding:44px 14px 70px}
.palmares-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;color:var(--fg);margin-bottom:12px}
.palmares-content{display:block}
.palmares-photo{float:left;width:40%;max-height:64vh;object-fit:cover;object-position:top;border-radius:8px;margin-right:12px;margin-bottom:6px;border:2px solid var(--h1)}
.palmares-photo-ph{float:left;width:40%;height:64vh;border-radius:8px;margin-right:12px;margin-bottom:6px;background:linear-gradient(135deg,var(--h1)22,var(--h3)22);border:2px dashed var(--border);display:flex;align-items:center;justify-content:center;font-size:28px}
.palmares-text{font-size:15px;line-height:1.85;color:var(--fg);opacity:0.85;white-space:pre-wrap}
.palmares-clear{clear:both}

/* AD */
.ad-page{padding:44px 14px 70px;display:flex;flex-direction:column;min-height:100vh}
.ad-title-txt{font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:2px;margin-bottom:14px;color:var(--fg)}
.ad-content{flex:1;display:flex;align-items:center;justify-content:center}
.ad-ph{background:var(--card);border:1px dashed var(--border);border-radius:8px;height:140px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:13px;width:100%}

/* VOTE */
.vote-page{padding:44px 14px 70px}
.vote-title{font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--fg);margin-bottom:2px}
.vote-sub{color:var(--muted);font-size:11px;margin-bottom:14px}
.vote-closed-banner{background:linear-gradient(135deg,var(--h1),var(--h3));border-radius:10px;padding:14px;text-align:center;margin-bottom:14px}
.vote-closed-banner p{color:#fff;font-size:13px;font-weight:600}
.vote-cands{display:flex;flex-direction:column;gap:8px}
.vote-card{background:var(--card);border:2px solid var(--border);border-radius:10px;padding:13px 14px;cursor:pointer;transition:all 0.2s;display:flex;flex-direction:column;gap:6px;position:relative}
.vote-card:hover:not(.stopped){border-color:#444}
.vote-card.voted{border-color:#00e676;background:rgba(0,230,118,0.06)}
.vote-card.mvp-card{border-color:gold;background:rgba(255,215,0,0.08)}
.mvp-badge{position:absolute;top:-10px;right:12px;background:gold;color:#000;font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:2px;padding:2px 10px;border-radius:10px}
.vc-top{display:flex;align-items:center;justify-content:space-between}
.vc-name{font-family:'Oswald',sans-serif;font-size:18px;font-weight:700;letter-spacing:1px;color:#fff}
.vc-check{width:22px;height:22px;border-radius:50%;border:2px solid #444;display:flex;align-items:center;justify-content:center;font-size:11px;transition:all 0.2s;flex-shrink:0;color:#fff}
.vote-card.voted .vc-check{background:#00e676;border-color:#00e676;color:#000}
.vc-bar-wrap{background:rgba(255,255,255,0.08);border-radius:3px;height:5px;overflow:hidden}
.vc-bar{height:100%;border-radius:3px;background:#00e676;transition:width 0.5s ease;width:0%}
.vc-bar.mvp-bar{background:gold}
.vc-stats{display:flex;justify-content:space-between;align-items:center}
.vc-pct{font-size:16px;font-weight:700;color:#00e676}
.vc-cnt{font-size:10px;color:var(--muted)}
.vote-total{text-align:center;color:var(--muted);font-size:11px;margin-top:10px}
.notify-btn{width:100%;margin-top:14px;padding:11px;background:var(--card);border:1px solid var(--border);border-radius:8px;color:var(--fg);font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all 0.2s}
.notify-btn:hover{border-color:var(--h1)}
.notify-btn.active{background:rgba(0,230,118,0.08);border-color:#00e676;color:#00e676}

/* PROMO */
.promo-page{padding:44px 14px 70px;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center}
.promo-ph{background:var(--card);border:1px dashed var(--border);border-radius:8px;height:160px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:13px;width:100%}

/* PROGRAM */
.program-page{padding:44px 0 0}
.prog-photo{width:100%;height:33vh;object-fit:cover;display:block}
.prog-photo-ph{width:100%;height:33vh;background:var(--card);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:13px}
.prog-content{padding:16px 16px 70px}
.prog-title{font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:3px;color:var(--fg);margin-bottom:10px}
.prog-text{color:var(--fg);opacity:0.85;font-size:15px;line-height:1.8;white-space:pre-wrap}
</style>
</head>
<body>
<%
const FORMATIONS={
  '4-3-3':[[1],[4,3,2,5],[8,6,10],[9,7,11]],
  '4-4-2':[[1],[2,3,4,5],[6,7,8,9],[10,11]],
  '4-2-3-1':[[1],[2,3,4,5],[6,8],[7,10,11],[9]],
  '3-4-3':[[1],[2,5,3],[4,6,8,7],[9,10,11]],
  '4-1-4-1':[[1],[2,3,4,5],[6],[7,8,9,10],[11]],
  '5-4-1':[[1],[2,3,5,4,6],[7,8,9,10],[11]],
  '5-3-2':[[1],[2,3,5,4,6],[7,8,9],[10,11]]
};
function getRows(k){return FORMATIONS[k]||FORMATIONS['4-3-3'];}
function shirtSVG(f1,f2,stroke){
  return `<svg viewBox="0 0 50 55" xmlns="http://www.w3.org/2000/svg">
    <path d="M5,14 L0,28 L13,30 L13,54 L37,54 L37,30 L50,28 L45,14 L36,10 C34,16 16,16 14,10 Z" fill="${f1}" stroke="${stroke}" stroke-width="1.5"/>
    <path d="M14,10 C16,16 34,16 36,10 L38,6 C34,2 30,0 25,0 C20,0 16,2 12,6 Z" fill="${f2}" stroke="${stroke}" stroke-width="1.5"/>
  </svg>`;
}
const tocDefs=['Cuprins','Avancronica','JucƒÉtor Cheie','Clasament','Forma»õii de Start','Rezerve','Head to Head','Ce spun antrenorii','Palmares','ReclamƒÉ','JucƒÉtorul Meciului','Promo','Program'];
const tocItems=mag.tocItems&&mag.tocItems.length===13?mag.tocItems:tocDefs;
const tocPages=[2,[3,4],[5,6],7,8,9,10,11,12,13,14,15,16];

// Club logo snippet reused on all pages
const clubLogoHTML = mag.clubLogo
  ? `<div class="club-logo-btn" onclick="goToPage(2)"><img src="${mag.clubLogo}" class="club-logo-img"><span class="club-logo-label">CUPRINS</span></div>`
  : `<div class="club-logo-btn" onclick="goToPage(2)"><div class="club-logo-ph">üè†</div><span class="club-logo-label">CUPRINS</span></div>`;
%>

<div class="magazine" id="magazine">

<!-- P1 COVER -->
<div class="page" data-page="1">
  <div class="cover-page">
    <%if(mag.cover){%><img src="<%=mag.cover%>" class="cover-photo"><div class="cover-overlay"></div><%}else{%><div class="cover-no-photo"></div><div class="cover-overlay"></div><%}%>
    <div class="color-bar" style="position:absolute;top:0;left:0;right:0;z-index:3"></div>
    <%if(mag.clubLogo){%>
    <img src="<%=mag.clubLogo%>" class="cover-club-logo pos-<%=mag.logoPosition||'top-left'%> size-<%=mag.logoSize||'medium'%>">
    <%}%>
    <div class="cover-content">
      <div class="cover-comp">üèÜ <%=mag.competition%> ¬∑ <%=mag.matchDate%></div>
      <div class="cover-title"><%=mag.coverTitle||mag.homeTeam+' vs '+mag.awayTeam%></div>
      <div class="cover-meta">üèüÔ∏è <%=mag.stadium%></div>
    </div>
    <div class="color-bar"></div>
  </div>
</div>

<!-- P2 TOC -->
<div class="page" data-page="2">
  <%- clubLogoHTML %>
  <div class="toc-page">
    <div class="toc-header">
      <div class="toc-title">CUPRINS</div>
      <div class="toc-subtitle">ApasƒÉ pentru a naviga direct</div>
    </div>
    <div class="toc-list">
      <% tocItems.forEach(function(item,i){ const pg=tocPages[i]; const firstPg=Array.isArray(pg)?pg[0]:pg; const lastPg=Array.isArray(pg)?pg[pg.length-1]:pg; %>
      <div class="toc-item" id="toc-<%=i%>" onclick="goToPage(<%=firstPg%>)">
        <div class="toc-num"><%=firstPg%><%=lastPg!==firstPg?'-'+lastPg:''%></div>
        <div class="toc-text"><%=item%></div>
        <div class="toc-arrow">‚Ä∫</div>
      </div>
      <% }) %>
    </div>
  </div>
</div>

<!-- P3 -->
<div class="page" data-page="3">
  <%- clubLogoHTML %>
  <div class="pg">
    <div class="pg-label">Pagina 3</div>
    <div class="pg-subtitle"><%=mag.avancronicaTitle||'Avancronica'%></div>
    <div class="pg-body"><%=mag.avancronicaP1||'Con»õinut √Æn cur√¢nd...'%></div>
  </div>
</div>

<!-- P4 -->
<div class="page" data-page="4">
  <%- clubLogoHTML %>
  <div class="pg">
    <div class="pg-label">Pagina 4</div>
    <div class="pg-subtitle"><%=mag.avancronicaTitle||'Avancronica'%> (cont.)</div>
    <div class="pg-body"><%=mag.avancronicaP2||'Con»õinut √Æn cur√¢nd...'%></div>
  </div>
</div>

<!-- P5 -->
<div class="page" data-page="5">
  <%- clubLogoHTML %>
  <div class="player-area">
    <%if(mag.playerPhoto){%><img src="<%=mag.playerPhoto%>" class="player-photo"><%}else{%><div class="player-photo-ph">‚≠ê</div><%}%>
    <div class="player-info">
      <div class="player-name"><%=mag.playerTitle||'JucƒÉtorul Meciului'%></div>
      <%if(mag.playerSubtitle){%><div class="player-sub"><%=mag.playerSubtitle%></div><%}%>
    </div>
  </div>
  <div class="divider"></div>
  <div class="pg" style="padding-top:12px"><div class="pg-body"><%=mag.playerText||''%></div></div>
</div>

<!-- P6 -->
<div class="page" data-page="6">
  <%- clubLogoHTML %>
  <div class="pg">
    <div class="pg-label">Pagina 6</div>
    <div class="pg-subtitle" style="border-left-color:var(--a1)"><%=mag.playerTitle||'Profil'%></div>
    <div class="pg-body"><%=mag.playerText||''%></div>
  </div>
</div>

<!-- P7 STANDINGS -->
<div class="page" data-page="7">
  <%- clubLogoHTML %>
  <div class="standings-page">
    <div class="standings-title"><%=mag.standingsTitle||'Clasament'%></div>
    <%if(mag.standingsEmbed){%>
    <div class="standings-wrap" id="standingsWrap"><%- mag.standingsEmbed %></div>
    <%}else{%><div class="standings-ph">üìä AdaugƒÉ embed clasament</div><%}%>
  </div>
</div>

<!-- P8 FORMATIONS -->
<div class="page" data-page="8">
  <%- clubLogoHTML %>
  <div class="formations-page">
    <%
    const hC1=mag.homeColor1, hC2=mag.homeColor2||mag.homeColor1, hC3=mag.homeColor3||mag.homeColor1;
    const hRows=getRows(mag.homeFormation);const hRev=[...hRows].reverse();
    %>
    <div class="team-section">
      <div class="team-hdr">
        <%if(mag.homeLogoPhoto){%><img src="<%=mag.homeLogoPhoto%>" class="team-logo"><%}else{%><div class="team-logo-ph">üî¥</div><%}%>
        <div><div class="team-title" style="color:#c0392b"><%=mag.homeFormationTitle||mag.homeTeam%></div><div class="team-formation-lbl"><%=mag.homeFormation%></div></div>
      </div>
      <div class="pitch home-pitch"><div class="pitch-inner">
        <div class="penalty-box-top"></div><div class="penalty-box-bot"></div>
        <%let hi=0;hRev.forEach(function(row,ri){%>
        <div class="pitch-row"><%row.forEach(function(s){
          const num=(mag.homePlayerNumbers&&mag.homePlayerNumbers[hi])?mag.homePlayerNumbers[hi]:s;
          const name=(mag.homePlayerNames&&mag.homePlayerNames[hi])?mag.homePlayerNames[hi]:'';
          const isGK=(ri===hRev.length-1);
          const f1=isGK?'#f9e79f':hC1; const f2=isGK?'#f0d060':hC2; const stk=isGK?'#c0a000':'#00000033';
          hi++;
        %><div class="player-token"><div class="shirt-wrap"><%- shirtSVG(f1,f2,stk) %><div class="shirt-num <%=isGK?'dark':''%>"><%=num%></div></div><div class="token-name"><%=name%></div></div>
        <%})%></div>
        <%if(ri===Math.floor(hRev.length/2)-1){%><div class="mid-line"></div><%}%>
        <%})%>
      </div></div>
    </div>
    <%
    const aRows=getRows(mag.awayFormation);const aRev=[...aRows].reverse();
    %>
    <div class="team-section">
      <div class="team-hdr">
        <%if(mag.awayLogoPhoto){%><img src="<%=mag.awayLogoPhoto%>" class="team-logo"><%}else{%><div class="team-logo-ph">üü¢</div><%}%>
        <div><div class="team-title" style="color:#27ae60"><%=mag.awayFormationTitle||mag.awayTeam%></div><div class="team-formation-lbl"><%=mag.awayFormation%></div></div>
      </div>
      <div class="pitch away-pitch"><div class="pitch-inner">
        <div class="penalty-box-top"></div><div class="penalty-box-bot"></div>
        <%let ai=0;aRev.forEach(function(row,ri){%>
        <div class="pitch-row"><%row.forEach(function(s){
          const num=(mag.awayPlayerNumbers&&mag.awayPlayerNumbers[ai])?mag.awayPlayerNumbers[ai]:s;
          const name=(mag.awayPlayerNames&&mag.awayPlayerNames[ai])?mag.awayPlayerNames[ai]:'';
          const isGK=(ri===aRev.length-1);
          const f1=isGK?'#aed6f1':'#ffffff'; const f2=isGK?'#7fb3d3':'#e8e8e8'; const stk=isGK?'#27ae60':'#27ae6033';
          ai++;
        %><div class="player-token"><div class="shirt-wrap"><%- shirtSVG(f1,f2,stk) %><div class="shirt-num dark"><%=num%></div></div><div class="token-name"><%=name%></div></div>
        <%})%></div>
        <%if(ri===Math.floor(aRev.length/2)-1){%><div class="mid-line"></div><%}%>
        <%})%>
      </div></div>
    </div>
  </div>
</div>

<!-- P9 RESERVES -->
<div class="page" data-page="9">
  <%- clubLogoHTML %>
  <div class="reserves-page">
    <div class="reserves-hdr"><div class="reserves-hdr-title">REZERVE</div></div>
    <div class="reserves-body">
      <div class="res-col home-col">
        <div class="res-col-title" style="color:#c0392b;border-bottom:2px solid #c0392b"><%=mag.homeTeam%></div>
        <div class="res-text"><%=mag.homeReserves||'‚Äì'%></div>
      </div>
      <div class="res-col away-col">
        <div class="res-col-title" style="color:#27ae60;border-bottom:2px solid #27ae60"><%=mag.awayTeam%></div>
        <div class="res-text"><%=mag.awayReserves||'‚Äì'%></div>
      </div>
    </div>
  </div>
</div>

<!-- P10 H2H -->
<div class="page" data-page="10">
  <%- clubLogoHTML %>
  <div class="h2h-page">
    <div class="h2h-title"><%=mag.h2hTitle||'√ént√¢lniri directe'%></div>
    <%if(mag.h2hLabels&&mag.h2hLabels.length){%>
    <div class="h2h-rows">
      <%mag.h2hLabels.forEach(function(lbl,i){
        const val=mag.h2hValues&&mag.h2hValues[i]?mag.h2hValues[i]:'';
        const hw=mag.homeTeam.toLowerCase().split(' ')[0];
        const aw=mag.awayTeam.toLowerCase().split(' ')[0];
        const isHome=lbl.toLowerCase().includes(hw);
        const isAway=!isHome&&lbl.toLowerCase().includes(aw);
      %>
      <div class="h2h-row">
        <div class="h2h-label <%=isHome?'home-label':isAway?'away-label':''%>"><%=lbl%></div>
        <div class="h2h-value"><%=val%></div>
      </div>
      <%})%>
    </div>
    <%}%>
    <%if(mag.h2hYoutubeEmbed){%><div class="h2h-video"><%- mag.h2hYoutubeEmbed %></div><%}%>
  </div>
</div>

<!-- P11 COACHES -->
<div class="page" data-page="11">
  <%- clubLogoHTML %>
  <div class="coaches-page">
    <div class="coaches-title"><%=mag.coachesTitle||'Ce spun antrenorii'%></div>
    <div class="coaches-grid">
      <div class="coach-card">
        <%if(mag.homeCoachPhoto){%><img src="<%=mag.homeCoachPhoto%>" class="coach-photo"><%}else{%><div class="coach-photo-ph">üë®‚Äçüíº</div><%}%>
        <div class="coach-name"><%=mag.homeCoachName||'Antrenor Gazde'%></div>
        <div class="coach-team" style="color:var(--h1)"><%=mag.homeTeam%></div>
      </div>
      <div class="coach-card">
        <%if(mag.awayCoachPhoto){%><img src="<%=mag.awayCoachPhoto%>" class="coach-photo away"><%}else{%><div class="coach-photo-ph away">üë®‚Äçüíº</div><%}%>
        <div class="coach-name"><%=mag.awayCoachName||'Antrenor Oaspete'%></div>
        <div class="coach-team" style="color:var(--a1)"><%=mag.awayTeam%></div>
      </div>
    </div>
    <div class="coaches-texts">
      <div class="coach-text-block">
        <div class="coach-text-label" style="color:var(--h1)"><%=mag.homeCoachName||mag.homeTeam%></div>
        <div class="coach-text"><%=mag.homeCoachText||''%></div>
      </div>
      <div class="coach-text-block">
        <div class="coach-text-label" style="color:var(--a1)"><%=mag.awayCoachName||mag.awayTeam%></div>
        <div class="coach-text"><%=mag.awayCoachText||''%></div>
      </div>
    </div>
  </div>
</div>

<!-- P12 PALMARES -->
<div class="page" data-page="12">
  <%- clubLogoHTML %>
  <div class="palmares-page">
    <div class="palmares-title"><%=mag.palmaresTitle||'Palmares'%></div>
    <div class="palmares-content">
      <%if(mag.palmaresPhoto){%><img src="<%=mag.palmaresPhoto%>" class="palmares-photo"><%}else{%><div class="palmares-photo-ph">üèÜ</div><%}%>
      <div class="palmares-text"><%=mag.palmaresText||''%></div>
      <div class="palmares-clear"></div>
    </div>
  </div>
</div>

<!-- P13 AD -->
<div class="page" data-page="13">
  <%- clubLogoHTML %>
  <div class="ad-page">
    <%if(mag.adTitle){%><div class="ad-title-txt"><%=mag.adTitle%></div><%}%>
    <div class="ad-content"><%if(mag.adEmbed){%><%- mag.adEmbed %><%}else{%><div class="ad-ph">üì¢ Spa»õiu publicitar</div><%}%></div>
  </div>
</div>

<!-- P14 VOTE -->
<div class="page" data-page="14">
  <%- clubLogoHTML %>
  <div class="vote-page">
    <div class="vote-title">üèÖ JUCƒÇTORUL MECIULUI</div>
    <div class="vote-sub" id="voteSubtitle"><%=mag.voteStopped?'Votul s-a √Æncheiat':'VoteazƒÉ favoritul tƒÉu ¬∑ Un vot per dispozitiv'%></div>
    <%if(mag.voteStopped){%>
    <div class="vote-closed-banner"><p>üèÜ Votul s-a √Æncheiat! MVP: <strong><%=mag.mvp||'‚Äì'%></strong></p></div>
    <%}%>
    <%const cands=[mag.voteCandidate0,mag.voteCandidate1,mag.voteCandidate2];%>
    <%if(cands.some(c=>c&&c.trim())){%>
    <div class="vote-cands" id="voteCands">
      <%cands.forEach(function(name,i){if(name&&name.trim()){%>
      <div class="vote-card <%=mag.voteStopped?'stopped':''%> <%=mag.voteStopped&&mag.mvp===name?'mvp-card':''%>" id="vc<%=i%>" onclick="castVote(<%=i%>)">
        <%if(mag.voteStopped&&mag.mvp===name){%><div class="mvp-badge">MVP üèÜ</div><%}%>
        <div class="vc-top">
          <div class="vc-name"><%=name%></div>
          <div class="vc-check" id="chk<%=i%>">‚úì</div>
        </div>
        <div class="vc-bar-wrap"><div class="vc-bar <%=mag.voteStopped&&mag.mvp===name?'mvp-bar':''%>" id="bar<%=i%>"></div></div>
        <div class="vc-stats">
          <div class="vc-pct" id="pct<%=i%>">0%</div>
          <div class="vc-cnt" id="cnt<%=i%>">0 voturi</div>
        </div>
      </div>
      <%}})%>
    </div>
    <div class="vote-total" id="vTotal">0 voturi totale</div>
    <button class="notify-btn" id="notifyBtn" onclick="toggleNotify()">
      üîî NotificƒÉ-mƒÉ c√¢nd se deschide votul
    </button>
    <%}else{%><div style="color:var(--muted);text-align:center;padding:40px;font-size:14px">Candida»õii vor fi anun»õa»õi √Æn cur√¢nd</div><%}%>
  </div>
</div>

<!-- P15 PROMO -->
<div class="page" data-page="15">
  <%- clubLogoHTML %>
  <div class="promo-page">
    <%if(mag.promoEmbed){%><div style="width:100%"><%- mag.promoEmbed %></div><%}else{%><div class="promo-ph">üì£ Spa»õiu banner publicitar</div><%}%>
  </div>
</div>

<!-- P16 PROGRAM -->
<div class="page" data-page="16">
  <%- clubLogoHTML %>
  <div class="program-page">
    <%if(mag.stadiumPhoto){%><img src="<%=mag.stadiumPhoto%>" class="prog-photo"><%}else{%><div class="prog-photo-ph">üèüÔ∏è</div><%}%>
    <div class="prog-content">
      <div class="prog-title"><%=mag.programTitle||'Programul echipei noastre'%></div>
      <div class="prog-text"><%=mag.programText||''%></div>
    </div>
  </div>
</div>

</div>

<button class="arrow arrow-left hidden" id="arrowLeft" onclick="nav(-1)">‚Äπ</button>
<button class="arrow arrow-right" id="arrowRight" onclick="nav(1)">‚Ä∫</button>
<div class="nav-dots" id="navDots"><%for(let i=1;i<=16;i++){%><div class="dot <%=i===1?'active':''%>" onclick="goToPage(<%=i%>)"></div><%}%></div>
<div class="page-num" id="pageNum">1 / 16</div>

<script>
const MAG_ID='<%=mag.id%>';
const TOTAL=16;
let cur=1,sx=0,sy=0,drag=false;
let myVote=localStorage.getItem('v_'+MAG_ID);
myVote=myVote!==null?parseInt(myVote):null;
let notifyEnabled=localStorage.getItem('notify_'+MAG_ID)==='1';
const mag=document.getElementById('magazine');

// Update notify button state
function updateNotifyBtn(){
  const btn=document.getElementById('notifyBtn');
  if(!btn)return;
  if(notifyEnabled){btn.textContent='üîî Notificare activatƒÉ';btn.classList.add('active');}
  else{btn.textContent='üîî NotificƒÉ-mƒÉ c√¢nd se deschide votul';btn.classList.remove('active');}
}
updateNotifyBtn();

function toggleNotify(){
  if(!('Notification' in window)){alert('Browserul tƒÉu nu suportƒÉ notificƒÉri.');return;}
  if(notifyEnabled){notifyEnabled=false;localStorage.setItem('notify_'+MAG_ID,'0');updateNotifyBtn();return;}
  Notification.requestPermission().then(p=>{
    if(p==='granted'){notifyEnabled=true;localStorage.setItem('notify_'+MAG_ID,'1');updateNotifyBtn();
      new Notification('MatchMag üèÜ',{body:'Vei fi notificat c√¢nd votul se deschide!',icon:'/favicon.ico'});}
    else{alert('Permisiunea pentru notificƒÉri a fost refuzatƒÉ.');}
  });
}

// Poll for vote open (check every 30s if vote becomes active)
function checkVoteStatus(){
  fetch(`/api/votes/${MAG_ID}`).then(r=>r.json()).then(d=>{
    if(notifyEnabled&&!d.voteStopped&&cur===14){
      // vote is open - notify
      if(Notification.permission==='granted'){
        new Notification('‚öΩ Votul este deschis!',{body:'Alege jucƒÉtorul meciului acum!',icon:'/favicon.ico'});
        notifyEnabled=false;localStorage.setItem('notify_'+MAG_ID,'0');updateNotifyBtn();
      }
    }
    renderVotes(d.votes,d.voteStopped,d.mvp);
  });
}
setInterval(checkVoteStatus,30000);

function playRustle(){
  try{
    const ctx=new(window.AudioContext||window.webkitAudioContext)();
    const buf=ctx.createBuffer(1,ctx.sampleRate*0.12,ctx.sampleRate);
    const d=buf.getChannelData(0);
    for(let i=0;i<d.length;i++) d[i]=(Math.random()*2-1)*Math.exp(-i/(ctx.sampleRate*0.04));
    const src=ctx.createBufferSource();src.buffer=buf;
    const g=ctx.createGain();g.gain.setValueAtTime(0.15,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.12);
    const f=ctx.createBiquadFilter();f.type='bandpass';f.frequency.value=2800;f.Q.value=0.6;
    src.connect(f);f.connect(g);g.connect(ctx.destination);src.start();
  }catch(e){}
}

mag.addEventListener('touchstart',e=>{sx=e.touches[0].clientX;sy=e.touches[0].clientY;drag=true},{passive:true});
mag.addEventListener('touchend',e=>{
  if(!drag)return;
  const dx=e.changedTouches[0].clientX-sx,dy=e.changedTouches[0].clientY-sy;
  if(Math.abs(dx)>Math.abs(dy)&&Math.abs(dx)>40){playRustle();if(dx<0)nav(1);else nav(-1);}
  drag=false;
},{passive:true});
let msx=0;
mag.addEventListener('mousedown',e=>msx=e.clientX);
mag.addEventListener('mouseup',e=>{const dx=e.clientX-msx;if(Math.abs(dx)>50){playRustle();if(dx<0)nav(1);else nav(-1);}});

function nav(d){const n=cur+d;if(n>=1&&n<=TOTAL)goToPage(n);}

function goToPage(n){
  cur=n;
  mag.style.transition='transform 0.32s cubic-bezier(0.25,0.46,0.45,0.94)';
  mag.style.transform=`translateX(-${(n-1)*100}vw)`;
  setTimeout(()=>mag.style.transition='none',320);
  document.querySelectorAll('.dot').forEach((d,i)=>d.classList.toggle('active',i===n-1));
  document.getElementById('pageNum').textContent=`${n} / ${TOTAL}`;
  document.getElementById('arrowLeft').classList.toggle('hidden',n===1);
  document.getElementById('arrowRight').classList.toggle('hidden',n===TOTAL);
  const tocMap={2:0,3:1,4:1,5:2,6:2,7:3,8:4,9:5,10:6,11:7,12:8,13:9,14:10,15:11,16:12};
  document.querySelectorAll('.toc-item').forEach(el=>el.classList.remove('current'));
  if(tocMap[n]!==undefined){const el=document.getElementById('toc-'+tocMap[n]);if(el)el.classList.add('current');}
  if(n===14)loadVotes();
}

function castVote(ci){
  const prev=myVote;
  fetch(`/api/votes/${MAG_ID}`).then(r=>r.json()).then(d=>{
    if(d.voteStopped)return;
    if(myVote===ci)return;
    myVote=ci;localStorage.setItem('v_'+MAG_ID,ci);
    fetch(`/api/vote/${MAG_ID}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({candidate:ci,previousCandidate:prev})})
      .then(r=>r.json()).then(d=>renderVotes(d.votes,d.voteStopped,d.mvp));
  });
}

function loadVotes(){fetch(`/api/votes/${MAG_ID}`).then(r=>r.json()).then(d=>renderVotes(d.votes,d.voteStopped,d.mvp));}

function renderVotes(votes,stopped,mvp){
  if(!votes)return;
  const total=Object.values(votes).reduce((a,b)=>a+b,0);
  const el=document.getElementById('vTotal');if(el)el.textContent=`${total} vot${total!==1?'uri':''} totale`;
  const sub=document.getElementById('voteSubtitle');
  if(sub)sub.textContent=stopped?'Votul s-a √Æncheiat':'VoteazƒÉ favoritul tƒÉu ¬∑ Un vot per dispozitiv';
  const cands=['<%=mag.voteCandidate0%>','<%=mag.voteCandidate1%>','<%=mag.voteCandidate2%>'];
  [0,1,2].forEach(i=>{
    const card=document.getElementById('vc'+i);if(!card)return;
    const v=votes[i]||0,pct=total>0?Math.round(v/total*100):0;
    document.getElementById('bar'+i).style.width=pct+'%';
    document.getElementById('pct'+i).textContent=pct+'%';
    document.getElementById('cnt'+i).textContent=v+' vot'+(v!==1?'uri':'');
    card.classList.toggle('voted',!stopped&&myVote===i);
    card.classList.toggle('stopped',!!stopped);
    const isMVP=stopped&&mvp&&mvp===cands[i];
    card.classList.toggle('mvp-card',!!isMVP);
    const bar=document.getElementById('bar'+i);
    if(bar)bar.className='vc-bar'+(isMVP?' mvp-bar':'');
    // remove/add MVP badge
    let badge=card.querySelector('.mvp-badge');
    if(isMVP&&!badge){badge=document.createElement('div');badge.className='mvp-badge';badge.textContent='MVP üèÜ';card.insertBefore(badge,card.firstChild);}
    else if(!isMVP&&badge)badge.remove();
  });
}

if(document.getElementById('vc0'))loadVotes();
</script>
</body>
</html>
